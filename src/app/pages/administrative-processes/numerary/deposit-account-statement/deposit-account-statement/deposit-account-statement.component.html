<app-card [header]="true" [footer]="true">
  <div class="ch-content" header>
    <h5 class="title">Estado de cuenta (Dep칩sito)</h5>
    <!--<div class="mr-2">
      <div class="d-inline mr-2" *ngIf="!searchMode && !loading">
        <button
          type="button"
          class="btn btn-primary active btn-sm"
          (click)="enableSearchMode()">
          <i class="bx bx-search-alt bx-sm float-icon"></i>
        </button>
      </div>
      <div class="d-inline mx-2" *ngIf="searchMode && !loading">
        <div class="btn-group">
          <button
            type="button"
            class="btn btn-primary btn-sm"
            (click)="confirmSearch()">
            <i class="bx bx-check bx-sm float-icon"></i>
          </button>
          <button
            type="button"
            class="btn btn-primary btn-sm"
            (click)="cancelSearch()">
            <i class="bx bx-x bx-sm float-icon"></i>
          </button>
        </div>
      </div>
    </div>-->
  </div>
  <div body>
    <!--<div class="row">
      <div class="col-md-12">
        <h5 class="title">
          <i class="fa fa-filter" aria-hidden="true"></i> Filtrar por:
        </h5>
      </div>
    </div>-->
    <div class="row mt-2 mb-1">
      <form action="" class="form-material" [formGroup]="form">
        <!--<div class="row pt-5">
          <div class="col-md-3">
            <form-field [control]="form.get('goodId')" label="No. Bien">
              <input
                type="text"
                class="form-control"
                formControlName="goodId" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field
              [control]="form.get('fileNumber')"
              label="No. Expediente">
              <input
                type="text"
                class="form-control"
                formControlName="fileNumber" />
            </form-field>
          </div>
        </div>-->
        <h5 class="title">Datos del Dep칩sito</h5>
        <div class="row pb-4">
          <div class="col text-right">
            <div class="btn-group">
              <!-- <button
                type="button"
                tooltip="Agregar"
                containerclass="tooltip-style"
                class="btn btn-info btn-sm active ml-2 mr-2">
                <i class="bx bx-plus bx-sm float-icon"></i>
              </button> -->
              <button
                class="btn btn-primary btn-sm active mx-1"
                [disabled]="!validDetail"
                (click)="detailCalculation()">
                Estado de Cuenta
              </button>
              <button
                class="btn btn-primary btn-sm active mx-1"
                (click)="openFormParameter()">
                Par치metros
              </button>
            </div>
          </div>
        </div>
        <div class="row pt-4">
          <!-- <div class="col-md-3">
            <form-field [control]="form.get('account')">
              <ngx-select
                label="Cuenta"
                [form]="form"
                control="account"
                [data]="accountChecksSelect"
                value="accountOriginDepositNumber"
                bindLabel="accountOriginDepositNumber"
                label="Cuenta"
                (fetchItems)="returnChecks($event)"
                (change)="changeChecks($event)"></ngx-select>
            </form-field>
          </div> -->

          <div class="col-md-3">
            <form-field
              [control]="expedientFilter"
              label="Filtrar por Expediente">
              <input
                type="number"
                class="form-control"
                formControlName="expedientFilter" />
            </form-field>
          </div>
          <div class="col-md-3">
            <ng-custom-select-loading
              [isLoadInOnInit]="false"
              [form]="form"
              formControlName="goodFilter"
              label="Filtrar por Bien"
              path="good/api/v1/good"
              value="goodId"
              bindLabel="goodId"
              paramSearch="filter.goodId"
              prefixSearch="$eq"
              (valueChange)="changeGood($event)">
            </ng-custom-select-loading>
            <!-- <form-field [control]="form.get('good')">
              <ngx-select
                label="Bien"
                [form]="form"
                control="good"
                [data]="goodSelect"
                value="id"
                bindLabel="description"
                label="Bien"
                (fetchItems)="returnChecks($event)"
                (change)="changeGood($event)"></ngx-select>
            </form-field> -->
          </div>
        </div>

        <!--<div class="row pt-4">
          <div class="col-md-6" [formGroup]="form" *ngIf="form">
            <form-field
              [control]="form.get('depositDate')"
              label="Fecha deposito">
              <input
                [maxDate]="maxDate"
                class="form-control"
                formControlName="depositDate"
                (bsValueChange)="onChange($event,form.get('depositDate'), form.get('cutoffDate'))"
                bsDatepicker />
            </form-field>
          </div>
          <div class="col-md-6" [formGroup]="form" >
            <form-field [control]="form.get('cutoffDate')" label="Fecha de corte">
              <input
                [maxDate]="maxDate"
                class="form-control"
                formControlName="formFin"
                (bsValueChange)="onChangeFin($event, form.get('cutoffDate'))"
                [minDate]="form.get('cutoffDate').value"
                bsDatepicker />
            </form-field>
          </div>
        </div>-->

        <div class="row pt-4">
          <div class="col-md-3">
            <app-select-modal-table-shared
              [form]="form"
              [disabled]="false"
              [widthDescription]="false"
              [haveSelectColumns]="true"
              [haveColumnFilters]="true"
              label="Cuenta"
              formField="account"
              [service]="detailsIndMovementService"
              [columnsType]="columnsType"
              searchField="description"
              id="accountkey"
              title="Cuenta"
              (selectRow)="
                changeChecks($event)
              "></app-select-modal-table-shared>
            <!-- <form-field [control]="form.get('account')">
              <ngx-select
                label="Cuenta"
                [form]="form"
                control="account"
                [data]="accountChecksSelect"
                value="accountnumber"
                bindLabel="accountnumber"
                label="Cuenta"
                [labelTemplate]="accountLabel"
                [optionTemplate]="accountOption"
                (fetchItems)="returnChecks($event)"
                (change)="changeChecks($event)"></ngx-select>
              <ng-template #accountLabel let-item="item">
                {{ item.accountnumber }} - {{ item.movementnumber }} -
                {{ item.devolutionnumber }}
              </ng-template>
              <ng-template #accountOption let-item="item">
                <div
                  [title]="
                    item.accountnumber +
                    '-' +
                    item.movementnumber +
                    '-' +
                    item.devolutionnumber
                  ">
                  {{ item.accountnumber }} - {{ item.movementnumber }} -
                  {{ item.devolutionnumber }}
                </div>
              </ng-template>
            </form-field> -->
          </div>
          <div class="col-md-3">
            <form-field [control]="form.get('bank')" label="Banco">
              <input
                type="text"
                class="form-control"
                formControlName="bank"
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field [control]="form.get('currency')" label="Moneda">
              <input
                type="text"
                class="form-control"
                formControlName="currency"
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field [control]="form.get('amount')" label="Importe">
              <input
                type="text"
                class="form-control"
                formControlName="amount"
                [readonly]="readonly" />
            </form-field>
          </div>
        </div>
        <div class="row pt-4">
          <div class="col-md-3">
            <form-field [control]="goodId" label="Bien">
              <input
                type="number"
                class="form-control"
                formControlName="goodId"
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field [control]="form.get('status')" label="Estatus">
              <input
                readonly
                type="text"
                class="form-control"
                formControlName="status" />
            </form-field>
          </div>
          <div class="col-md-6 fixTextarea">
            <form-field
              [control]="form.get('goodDescription')"
              label="Descripci칩n">
              <textarea
                readonly
                rows="2"
                class="form-control"
                formControlName="goodDescription"
                [max-length]="4000"></textarea>
            </form-field>
          </div>
        </div>
        <div class="row mt-4">
          <div class="col-md-3">
            <form-field [control]="expedient" label="Expediente">
              <input
                type="number"
                class="form-control"
                formControlName="expedient"
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3" [class]="readonly ? 'disabledInput' : ''">
            <form-field
              [control]="form.get('depositDate')"
              label="Fecha Dep칩sito">
              <input
                type="text"
                formControlName="depositDate"
                class="form-control"
                bsDatepicker
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3" [class]="readonly ? 'disabledInput' : ''">
            <form-field
              [control]="form.get('transfDate')"
              label="Fecha Transferencia">
              <input
                type="text"
                formControlName="transfDate"
                class="form-control"
                bsDatepicker
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field [control]="form.get('indicated')" label="Indiciado">
              <input
                type="text"
                class="form-control"
                formControlName="indicated"
                [readonly]="readonly" />
            </form-field>
          </div>
        </div>
        <div class="row mt-4">
          <div class="col-md-6">
            <form-field
              [control]="form.get('avPrevious')"
              label="Averiguaci&oacute;n Previa">
              <input
                type="text"
                class="form-control"
                formControlName="avPrevious"
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-6">
            <form-field
              [control]="form.get('criminalCase')"
              label="Causa penal">
              <input
                type="text"
                class="form-control"
                formControlName="criminalCase"
                [readonly]="readonly" />
            </form-field>
          </div>
        </div>
      </form>
    </div>
    <h5 class="title">Datos para c치lculo</h5>
    <div class="row pt-4 mt-4">
      <div class="col text-right">
        <button
          class="btn btn-primary btn-sm active mx-1"
          [disabled]="!validCheck"
          (click)="interestCheck()">
          Cheque Complementario
        </button>
      </div>
    </div>
    <div class="row pt-5">
      <form action="" class="form-material" [formGroup]="form">
        <div class="row mt-4">
          <div
            class="col-md-3"
            [class]="!userChecks && readonly ? 'disabledInput' : ''">
            <!---->
            <form-field
              [control]="form.get('transferDate')"
              label="Fecha de Transferencia">
              <!--<input
                [maxDate]="maxDate"
                class="form-control"
                formControlName="formFin"
                (bsValueChange)="onChangeFin($event, form.get('transferDate'))"
                [minDate]="minDate"
                bsDatepicker />-->
              <input
                type="text"
                formControlName="transferDate"
                class="form-control"
                bsDatepicker
                [maxDate]="maxTransferDate"
                [minDate]="minTransferDate"
                (bsValueChange)="updateTransferDate($event)" />
            </form-field>
          </div>
          <div
            class="col-md-3"
            [class]="!userChecks && readonly ? 'disabledInput' : ''">
            <form-field
              [control]="form.get('cutoffDate')"
              label="Fecha de Corte">
              <input
                type="text"
                formControlName="cutoffDate"
                class="form-control"
                [minDate]="transferDate"
                bsDatepicker
                (bsValueChange)="updateCutoffDate($event)" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field [control]="form.get('toReturn')" label="A Devolver">
              <input
                type="number"
                class="form-control"
                formControlName="toReturn"
                min="1"
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field
              [control]="form.get('interestCredited')"
              label="Inter&eacute;s Acreditado">
              <input
                type="number"
                class="form-control"
                formControlName="interestCredited"
                min="1"
                [readonly]="readonly" />
            </form-field>
          </div>
        </div>
        <div class="row mt-4">
          <div class="col-md-3">
            <form-field [control]="form.get('subTotal')" label="Sub Total">
              <input
                type="number"
                class="form-control"
                formControlName="subTotal"
                min="1"
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field
              [control]="form.get('costsAdmon')"
              label="Gastos de Admon.">
              <input
                type="number"
                class="form-control"
                formControlName="costsAdmon"
                min="1"
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field
              [control]="form.get('associatedCosts')"
              label="Costos Asociados">
              <input
                type="number"
                class="form-control"
                formControlName="associatedCosts"
                min="1"
                [readonly]="readonly" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field
              [control]="form.get('checkAmount')"
              label="Importe Cheque">
              <input
                type="number"
                class="form-control"
                formControlName="checkAmount"
                min="1"
                [readonly]="readonly" />
            </form-field>
          </div>
        </div>
      </form>
    </div>
    <h5 class="title">Datos para el cheque</h5>
    <div class="row mt-4">
      <div *ngIf="transferred === ''">{{ transferred }}</div>
      <div class="col text-right">
        <button
          class="btn btn-primary btn-sm active"
          (click)="transferMov()"
          [disabled]="!validTras">
          Traspasar
        </button>
      </div>
    </div>
    <div class="row pt-5">
      <form action="" class="form-material" [formGroup]="form">
        <div class="row mt-4">
          <div class="col-md-3">
            <form-field
              [control]="form.get('checkType')"
              label="Tipo de Cheque">
              <input
                type="text"
                class="form-control"
                formControlName="checkType"
                [readonly]="!userChecks" />
            </form-field>
          </div>
          <div class="col-md-3">
            <ng-custom-select-loading
              [isLoadInOnInit]="false"
              [load]="userChecks != null"
              [form]="form"
              [readonly]="!userChecks"
              paramLimitName="perPage"
              formControlName="bankAccount"
              label="Cuenta Bancaria"
              [path]="pathBankAccount"
              value="cve_cuenta"
              bindLabel="cve_cuenta"
              paramSearch="filter.cve_cuenta"
              prefixSearch="$eq"
              (valueChange)="changeCveCuenta($event)">
            </ng-custom-select-loading>
            <!-- <form-field
              [control]="form.get('bankAccount')"
              label="Cuenta Bancaria">
              <input
                class="form-control"
                formControlName="bankAccount"
                min="1"
                pattern="^[0-9]+"
                [readonly]="!userChecks" />
            </form-field> -->
          </div>
          <div class="col-md-3">
            <form-field [control]="form.get('check')" label="Cheque">
              <input
                type="number"
                class="form-control"
                formControlName="check"
                min="1"
                pattern="^[0-9]+"
                [readonly]="readonly && !userChecks" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field [control]="form.get('bankCheck')" label="Banco">
              <input
                type="text"
                class="form-control"
                readonly
                formControlName="bankCheck" />
            </form-field>
          </div>
        </div>
        <div class="row mt-4">
          <div
            class="col-md-3"
            [class]="!userChecks && readonly ? 'disabledInput' : ''">
            <form-field
              [control]="form.get('expeditionDate')"
              label="Fecha Expedici&oacute;n">
              <input
                type="text"
                formControlName="expeditionDate"
                class="form-control"
                [maxDate]="maxExpeditionDate"
                bsDatepicker
                (bsValueChange)="validateExpeditionCheck($event)" />
            </form-field>
          </div>
          <div
            class="col-md-3"
            [class]="!userChecks && readonly ? 'disabledInput' : ''">
            <form-field
              [control]="form.get('collectionDate')"
              label="Fecha Cobro">
              <input
                type="text"
                formControlName="collectionDate"
                class="form-control"
                [minDate]="minCollectionDate"
                bsDatepicker />
            </form-field>
          </div>
          <div class="col-md-6">
            <!-- <ng-custom-select-loading
              [isLoadInOnInit]="false"
              [load]="userChecks != null"
              [form]="form"
              paramLimitName="perPage"
              formControlName="beneficiary"
              label="Beneficiario"
              [path]="pathBeneficiary"
              value="beneficiario_cheque"
              bindLabel="beneficiario_cheque">
            </ng-custom-select-loading> -->
            <form-field
              [control]="form.get('beneficiary')"
              label="Beneficiario">
              <input
                type="text"
                class="form-control"
                formControlName="beneficiary"
                [readonly]="readonly && !userChecks" />
            </form-field>
          </div>
        </div>
      </form>
    </div>
  </div>
</app-card>
