<app-card [header]="true">
  <div class="ch-content" header>
    <h5 class="title">Reporte de implementacion</h5>
  </div>
  <div body>
    <h5 class="title">Ordenes de Servicio</h5>
    <form [formGroup]="serviceOrdersForm" class="form-material">
      <div class="row margin-input">
        <div class="col-md-4">
          <form-field
            [control]="serviceOrdersForm.get('noFormat')"
            label="Clave de orden de Servicio">
            <input
              type="number"
              formControlName="noFormat"
              class="form-control"
              maxlength="10"
              (input)="getReportImp()" />
          </form-field>
        </div>
        <div class="col-md-4">
          <form-field [control]="serviceOrdersForm.get('process')">
            <ngx-select
              label="Proceso"
              [form]="serviceOrdersForm"
              [data]="process"
              (fetchItems)="getProcess($event)"
              bindLabel="proAndName"
              control="process"
              [searchOnInit]="true"
              [showTooltip]="true"
              termMaxLength="50"
              value="processNumber"
              [labelTemplate]="proLabel"
              [optionTemplate]="proOption"
              (change)="getServices()">
            </ngx-select>
            <ng-template #proLabel let-item="item">
              {{ item.processNumber + ' - ' + item.description }}
            </ng-template>
            <ng-template #proOption let-item="item">
              <div [title]="item.processNumber + '-' + item.description">
                {{ item.processNumber + ' - ' + item.description }}
              </div>
            </ng-template>
          </form-field>
        </div>
        <div class="col-md-4">
          <form-field [control]="serviceOrdersForm.get('serviceOrderKey')">
            <ngx-select
              label="Servicio"
              [form]="serviceOrdersForm"
              [data]="serviceOrderKey"
              (fetchItems)="getServices()"
              bindLabel="proAndName"
              control="serviceOrderKey"
              [searchOnInit]="true"
              [showTooltip]="true"
              termMaxLength="50"
              value="no_servicio"
              [labelTemplate]="serLabel"
              [optionTemplate]="serOption"
              (change)="getTypes()">
            </ngx-select>
            <ng-template #serLabel let-item="item">
              {{ item.no_servicio + ' - ' + item.descripcion }}
            </ng-template>
            <ng-template #serOption let-item="item">
              <div [title]="item.no_servicio + '-' + item.descripcion">
                {{ item.no_servicio + ' - ' + item.descripcion }}
              </div>
            </ng-template>
          </form-field>
        </div>
        <div class="col-md-4">
          <form-field [control]="serviceOrdersForm.get('type')">
            <ngx-select
              label="Tipo"
              [form]="serviceOrdersForm"
              [data]="types"
              (fetchItems)="getTypes()"
              (change)="getTurns()"
              bindLabel="serAndName"
              control="type"
              [searchOnInit]="true"
              [showTooltip]="true"
              termMaxLength="50"
              value="no_tiposervicio"
              [labelTemplate]="typeLabel"
              [optionTemplate]="typeOption">
            </ngx-select>
            <ng-template #typeLabel let-item="item">
              {{ item.no_tiposervicio + ' - ' + item.descripcion }}
            </ng-template>
            <ng-template #typeOption let-item="item">
              <div [title]="item.no_tiposervicio + '-' + item.descripcion">
                {{ item.no_tiposervicio + ' - ' + item.descripcion }}
              </div>
            </ng-template>
          </form-field>
        </div>
        <div class="col-md-4">
          <form-field [control]="serviceOrdersForm.get('turno')">
            <ngx-select
              label="Turno"
              [form]="serviceOrdersForm"
              [data]="turnos"
              (fetchItems)="getTurns()"
              bindLabel="turnAndName"
              control="turno"
              [searchOnInit]="true"
              [showTooltip]="true"
              termMaxLength="50"
              value="no_turno"
              [labelTemplate]="turnLabel"
              [optionTemplate]="turnOption">
            </ngx-select>
            <ng-template #turnLabel let-item="item">
              {{ item.no_turno + ' - ' + item.descripcion }}
            </ng-template>
            <ng-template #turnOption let-item="item">
              <div [title]="item.no_turno + '-' + item.descripcion">
                {{ item.no_turno + ' - ' + item.descripcion }}
              </div>
            </ng-template>
          </form-field>
        </div>
        <div class="col-md-4">
          <form-field [control]="serviceOrdersForm.get('regionalCoordination')">
            <ngx-select
              label="Coordinación Regional"
              [form]="serviceOrdersForm"
              [data]="delegation"
              (fetchItems)="initForm()"
              bindLabel="initAndName"
              control="regionalCoordination"
              [searchOnInit]="true"
              [showTooltip]="true"
              termMaxLength="50"
              value="delegacion"
              [labelTemplate]="initLabel"
              [optionTemplate]="initOption">
            </ngx-select>
            <ng-template #initLabel let-item="item">
              {{ item.delegacion }}
            </ng-template>
            <ng-template #initOption let-item="item">
              <div [title]="item.delegacion">
                {{ item.delegacion }}
              </div>
            </ng-template>
          </form-field>
        </div>
        <div class="col-md-4">
          <form-field
            [control]="serviceOrdersForm.get('status')"
            label="Estatus">
            <ng-select formControlName="status" class="form-control pt-1">
              <ng-option value="Autorizda">AUTORIZADA</ng-option>
              <ng-option value="Cancelada">CANCELADA</ng-option>
              <ng-option value="Proceso">PROCESO</ng-option>
              <ng-option value="Rechazado">RECHAZADO</ng-option>
            </ng-select>
          </form-field>
        </div>
        <div class="col-md-4">
          <form-field
            [control]="serviceOrdersForm.get('reportKey')"
            label="Clave del Reporte">
            <input
              type="text"
              formControlName="reportKey"
              class="form-control"
              [maxLength]="30"
              readonly />
          </form-field>
        </div>
        <!-- <div class="col-md-4">
          <form-field [control]="serviceOrdersForm.get('authorizationDate')" label="Fecha de Autorización">
            <input type="text" formControlName="authorizationDate" [max]="maxDate" class="form-control" bsDatepicker />
          </form-field>
        </div>
        <div class="col-md-4">
          <form-field [control]="serviceOrdersForm.get('dateCapture')" label="Fecha de Captura">
            <form-field [control]="form.get('from')" label="Fecha de Captura">
              <input [maxDate]="maxDate" formControlName="dateCapture" class="form-control" bsDatepicker />
            </form-field>
        </div> -->
        <div class="col-md-4">
          <form-field
            [control]="serviceOrdersForm.get('dateCapture')"
            label="Fecha de Captura">
            <input
              [maxDate]="maxDate"
              formControlName="dateCapture"
              class="form-control"
              bsDatepicker />
          </form-field>
        </div>
        <div class="col-md-4">
          <form-field
            [control]="serviceOrdersForm.get('authorizationDate')"
            label="Fecha de Autorización">
            <input
              [maxDate]="maxDate"
              formControlName="dateCapture"
              class="form-control"
              [min]="serviceOrdersForm.get('dateCapture').value"
              [minDate]="serviceOrdersForm.get('dateCapture').value"
              [ngModel]="
                serviceOrdersForm.get('authorizationDate').value <
                serviceOrdersForm.get('dateCapture').value
                  ? serviceOrdersForm.get('dateCapture').value
                  : serviceOrdersForm.get('authorizationDate').value
              "
              bsDatepicker />
          </form-field>
        </div>

        <div class="col-md-12">
          <form-field
            [control]="serviceOrdersForm.get('observations')"
            label="Observaciones">
            <textarea
              class="form-control"
              formControlName="observations"></textarea>
          </form-field>
        </div>
      </div>
    </form>
    <div footer>
      <div class="d-flex justify-content-center">
        <div class="m-3">
          <button
            (click)="cargaBienes()"
            type="button"
            class="btn btn-info active btn-sm mr-3">
            Incorpora
            <i class="bx bx-plus bx-sm float-icon"></i>
          </button>
        </div>
        <div class="m-3">
          <button
            type="button"
            class="btn btn-danger active btn-sm"
            (click)="cleanForm()">
            Limpiar <i class="fas fa-eraser bx-sm float-icon"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="margin-input">
      <h5 class="title">Bienes del Reporte Implementación</h5>
      <div class="row pt-4">
        <div class="col-md-12">
          <div [class]="loading ? 'table-loading' : ''">
            <ng2-smart-table
              [attr.class]="'table-bordered'"
              [settings]="settings"
              (userRowSelect)="onUserRowSelect($event)"
              [source]="dataTableGood">
            </ng2-smart-table>
          </div>
        </div>
        <app-pagination
          [params]="params"
          [totalItems]="totalItems"></app-pagination>
      </div>
    </div>

    <div class="margin-input">
      <h5 class="title">Reportes de Implementación</h5>
      <div class="row pt-4">
        <div class="col-md-12">
          <div [class]="loading ? 'table-loading' : ''">
            <ng2-smart-table
              [attr.class]="'table-bordered'"
              [settings]="settings2"
              [source]="bienesStrategy">
            </ng2-smart-table>
          </div>
        </div>
        <app-pagination
          [params]="params"
          [totalItems]="totalItems2"></app-pagination>
      </div>
    </div>
    <div footer>
      <div class="d-flex justify-content-center">
        <div class="m-3">
          <button
            type="button"
            class="btn btn-primary active btn-sm"
            (click)="pupGenera()">
            Genera <i class="fas fa-print bx-sm float-icon"></i>
          </button>
        </div>
        <div class="m-3">
          <button
            type="button"
            class="btn btn-danger active btn-sm"
            (click)="elimina()">
            Elimina <i class="fas fa-trash bx-sm float-icon"></i>
          </button>
        </div>
        <div class="m-3">
          <button
            type="button"
            class="btn btn-primary active btn-sm"
            (click)="incorpora()">
            Incorpora <i class="bx bx-search-alt bx-sm float-icon"></i>
          </button>
        </div>
        <div class="m-3">
          <button
            type="button"
            class="btn btn-primary active btn-sm"
            (click)="validaForm()">
            Nuevos Costos <i class="fas fa-print bx-sm float-icon"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</app-card>
