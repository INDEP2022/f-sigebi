<app-modal>
  <div header>
    <h5 class="modal-title">
      {{ comerDetExpense ? 'Editar' : 'Nueva' }} {{ title }}
    </h5>
  </div>
  <div body>
    <form class="form-material" [formGroup]="form">
      <div *ngIf="comerDetExpense">
        <form-field [control]="expenseDetailNumber" label="Composición">
          <input
            class="form-control"
            formControlName="expenseDetailNumber"
            readonly />
        </form-field>
      </div>

      <div class="row">
        <div class="pb-2 col-md-12">
          <ng-custom-select-loading
            *ngIf="address === 'M'"
            [form]="form"
            [updateValues]="true"
            [isLoadInOnInit]="!comerDetExpense"
            [path]="pathGood"
            formControlName="goodNumber"
            [readonly]="comerDetExpense && chargeGoodsByLote"
            label="No. Bien"
            value="goodNumber"
            bindLabel="description"
            paramSearch="filter.description"
            prefixSearch="$ilike"
            secondParamSearch="filter.goodNumber"
            typeInput="post"
            (valueChange)="fillGoodM($event)"
            (getObject)="fillCvman($event)"
            [bodyPost]="bodyPost"
            [labelTemplate]="goodLabel"
            [optionTemplate]="goodOption">
          </ng-custom-select-loading>

          <!-- <form-field
            label="No. Bien"
            [control]="goodNumber"
            *ngIf="address === 'M'">
            <ng-custom-select-loading>

            </ng-custom-select-loading>
            <ng-select
              formControlName="goodNumber"
              class="form-control"
              loadingText="Cargando mandatos"
              [readonly]="comerDetExpense && chargeGoodsByLote"
              [clearable]="true"
              [hideSelected]="true"
              [virtualScroll]="true"
              (change)="onChange($event)">
              <ng-option *ngFor="let row of goods" [value]="row.goodNumber">
                {{ row.goodNumber }}-{{ row.description }}
              </ng-option>
            </ng-select>
          </form-field> -->

          <ng-custom-select-loading
            *ngIf="address !== 'M'"
            [form]="form"
            [updateValues]="true"
            [path]="pathGoodI"
            [isLoadInOnInit]="!comerDetExpense"
            formControlName="goodNumber"
            label="No. Bien"
            value="goodNumber"
            bindLabel="description"
            paramSearch="filter.description"
            prefixSearch="$ilike"
            secondParamSearch="filter.goodNumber"
            typeInput="post"
            [bodyPost]="bodyPostI"
            (valueChange)="setCvmanI($event)"
            (getObject)="fillCvman($event)"
            [labelTemplate]="goodLabel"
            [optionTemplate]="goodOption">
          </ng-custom-select-loading>
          <ng-template #goodLabel let-item="item">
            {{ item.goodNumber }} - {{ item.description }}
          </ng-template>
          <ng-template #goodOption let-item="item">
            <div [title]="item.goodNumber + '-' + item.description">
              {{ item.goodNumber }} - {{ item.description }}
            </div>
          </ng-template>
        </div>
      </div>
      <div class="row">
        <div class="pb-2 col-md-12">
          <ng-template #cvmanLabel let-item="item">
            {{ item.cvman }} - {{ item.key }}
          </ng-template>
          <ng-template #cvmanOption let-item="item">
            <div [title]="item.cvman + '-' + item.key">
              {{ item.cvman }} - {{ item.key }}
            </div>
          </ng-template>
          <ng-custom-select-loading
            [form]="form"
            [path]="pathCvmans"
            formControlName="cvman"
            label="Mandato"
            value="cvman"
            bindLabel="key"
            paramSearch="filter.key"
            prefixSearch="$ilike"
            secondParamSearch="filter.cvman"
            typeInput="post"
            [bodyPost]="bodyPostCVman"
            [labelTemplate]="cvmanLabel"
            [optionTemplate]="cvmanOption">
          </ng-custom-select-loading>

          <!-- <form-field label="Mandato" [control]="cvman">
            <ng-select
              formControlName="cvman"
              class="form-control"
              loadingText="Cargando mandatos"
              [clearable]="true"
              [hideSelected]="true"
              [virtualScroll]="true"
              [loading]="loadingCvmans">
              <ng-option *ngFor="let row of cvmans" [value]="row.cvman">
                {{ row.cvman }}-{{ row.key }}
              </ng-option>
            </ng-select>
          </form-field> -->
        </div>
      </div>
      <div class="row">
        <div class="pb-2 col-md-4">
          <form-field [control]="amount" label="Monto">
            <input
              class="form-control"
              formControlName="amount"
              currencyMask
              type="text"
              maxlength="17" />
          </form-field>
        </div>
        <div class="pb-2 col-md-4">
          <form-field [control]="vat" label="IVA">
            <input
              currencyMask
              type="text"
              maxlength="15"
              class="form-control"
              formControlName="vat" />
          </form-field>
        </div>
        <div class="pb-2 col-md-4">
          <form-field [control]="vatWithholding" label="Retención IVA">
            <input
              currencyMask
              type="text"
              maxlength="13"
              class="form-control"
              formControlName="vatWithholding" />
          </form-field>
        </div>
      </div>
      <div class="row">
        <div class="pb-2 col-md-4">
          <form-field [control]="isrWithholding" label="Retención ISR">
            <input
              currencyMask
              type="text"
              maxlength="13"
              class="form-control"
              formControlName="isrWithholding" />
          </form-field>
        </div>
        <div class="pb-2 col-md-4">
          <form-field [control]="budgetItem" label="Partida">
            <input
              type="text"
              class="form-control"
              formControlName="budgetItem"
              maxlength="1" />
          </form-field>

          <!-- <ng-custom-select-loading
            [form]="form"
            [updateValues]="true"
            path="goodfinder/api/v1/good-query?filter.transferNumberExpedient=$not:$null"
            label="No. Bien"
            formControlName="goodNumber"
            value="id"
            bindLabel="description"
            paramSearch="filter.description"
            prefixSearch="$ilike"
            secondParamSearch="filter.id"
            [labelTemplate]="goodLabel"
            [optionTemplate]="goodOption"
            (valueChange)="getTransferent($event)">
          </ng-custom-select-loading>
          <ng-template #goodLabel let-item="item">
            {{ item.id }} - {{ item.description }}
          </ng-template>
          <ng-template #goodOption let-item="item">
            <div [title]="item.id + '-' + item.description">
              {{ item.id }} - {{ item.description }}
            </div>
          </ng-template> -->
        </div>
      </div>
    </form>
  </div>
  <div footer>
    <div class="d-flex justify-content-center">
      <div class="m-3">
        <confirm-button
          [disabled]="form.invalid || clickedButton"
          text="Aceptar"
          (confirm)="confirm()">
        </confirm-button>
      </div>
      <div class="m-3">
        <button type="button" class="btn btn-danger active" (click)="close()">
          Cancelar
        </button>
      </div>
    </div>
  </div>
</app-modal>
