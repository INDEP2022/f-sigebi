<app-card [header]="true">
  <div class="ch-content" header>
    <h5 class="title">Envío de movimientos a SIRSAE</h5>
  </div>
  <div body>
    <form class="form-material" [formGroup]="form">
      <div class="row mt-3">
        <div class="col-12">
          <div class="row">
            <div class="col-sm-2 col-lg-2">
              <form-field [control]="form.get('event')">
                <ngx-select
                  [form]="form"
                  [searchOnInit]="true"
                  [data]="comerEventSelect"
                  value="id"
                  bindLabel="id"
                  label="Evento"
                  (fetchItems)="getComerEvents($event)"
                  control="event"
                  (change)="selectEvent($event)">
                </ngx-select>
              </form-field>
            </div>
            <div class="col-sm-4 col-md-4">
              <form-field
                [control]="form.get('description')"
                label="Descripción">
                <input
                  [(ngModel)]="selectedEvent"
                  readonly
                  type="text"
                  class="form-control loading"
                  formControlName="description" />
              </form-field>
            </div>
            <div *ngIf="layout == 'M'" class="col-sm-2 col-md-2 col-xl-2 mt-2">
              <button
                *ngIf="layout == 'M'"
                [disabled]="!eventSelected || loading || loadingBtn"
                (click)="search()"
                class="btn btn-sm btn-block btn-primary active">
                Buscar <i class="bx bx-search-alt bx-sm float-icon"></i>
              </button>
            </div>
            <div *ngIf="layout == 'M'" class="col-sm-2 col-md-2 col-xl-2 mt-2">
              <button
                *ngIf="layout == 'M'"
                (click)="clear()"
                class="btn btn-sm btn-block btn-danger active">
                Limpiar <i class="fas fa-eraser"> </i>
              </button>
            </div>
            <div
              *ngIf="layout == 'I'"
              class="col-sm-3 col-md-3 col-xl-3 mt-2"></div>
            <div *ngIf="layout == 'M'" class="col-sm-2 col-md-2 col-xl-2 mt-2">
              <button
                [ngClass]="{ loading: loadingBtn }"
                [disabled]="loading || loadingBtn || !eventSelected"
                type="button"
                class="btn btn-primary btn-block btn-sm active mr-3"
                tooltip="Enviar a SIRSAE"
                containerClass="tooltip-style"
                (click)="enviarSIRSAE()">
                Enviar SIRSAE <i *ngIf="!loadingBtn" class="bx bx-send"></i>
              </button>
            </div>
            <div *ngIf="layout == 'I'" class="col-sm-3 col-md-3 col-xl-3">
              <button
                [ngClass]="{ loading: loadingBtnOII }"
                [disabled]="
                  loading ||
                  loadingBtn ||
                  !eventSelected ||
                  loadingBtnOII ||
                  loadingBtnOIICliente ||
                  loadingBtnSendIn
                "
                (click)="obtenerOIInmueble()"
                class="w-100 btn btn-sm btn-block btn-info active">
                Obtener OI
              </button>
            </div>
            <div
              *ngIf="layout == 'M'"
              class="col-sm-2 col-md-2 col-xl-2 mt-2 mb-3">
              <button
                [disabled]="loading || loadingBtn || !eventSelected"
                (click)="obtenerOI()"
                class="w-100 btn btn-sm btn-block btn-info active">
                Obtener OI
              </button>
            </div>
          </div>
          <div class="row mt-2">
            <div *ngIf="layout == 'I'" class="col-sm-2 col-lg-2">
              <form-field [control]="form.get('batch')">
                <ngx-select
                  [readonly]="!eventSelected"
                  [form]="form"
                  [data]="lotes"
                  bindLabel="lotPublic"
                  label="Lote"
                  (fetchItems)="getLotes($event, 'no')"
                  control="batch"
                  (change)="selectBatch($event)">
                </ngx-select>
              </form-field>
            </div>
            <div *ngIf="layout == 'I'" class="col-sm-4 col-md-4">
              <form-field [control]="form.get('cliente')" label="Cliente">
                <input
                  readonly
                  type="text"
                  class="form-control loading"
                  formControlName="cliente" />
              </form-field>
            </div>
            <div class="col-sm-3 col-md-3 col-xl-3 mt-2"></div>
            <div class="col-sm-3 col-md-3 col-xl-3 mt-2">
              <button
                [ngClass]="{ loading: loadingBtnSendIn }"
                [disabled]="
                  loading ||
                  loadingBtn ||
                  !eventSelected ||
                  loadingBtnOII ||
                  loadingBtnOIICliente ||
                  loadingBtnSendIn
                "
                *ngIf="layout == 'I'"
                type="button"
                class="btn btn-primary btn-block btn-sm active mr-3"
                tooltip=""
                containerClass="tooltip-style"
                (click)="enviarSIRSAE()">
                Enviar x Lote y/o Evento
                <i *ngIf="!loadingBtnSendIn" class="bx bx-send"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>
    <accordion [isAnimated]="true">
      <accordion-group
        [isOpen]="acordionOpen"
        [class.disabled]="!disabledBtnCerrar">
        <div accordion-heading class="d-flex justify-content-between">
          <h5>CLIENTES DEL EVENTO</h5>
        </div>
        <form class="form-material" [formGroup]="formInmueble">
          <div class="row mt-2" *ngIf="layout == 'I'">
            <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
              <div class="d-flex flex-row-reverse my-3">
                <div class="col-sm-2 col-md-2 col-xl-2 mt-2">
                  <button
                    *ngIf="layout == 'I'"
                    (click)="clearInmueble()"
                    class="btn btn-sm btn-block btn-danger active">
                    Limpiar <i class="fas fa-eraser"> </i>
                  </button>
                </div>
                <div class="col-sm-2 col-md-2 col-xl-2 mt-2 mr-2">
                  <button
                    *ngIf="layout == 'I'"
                    [disabled]="
                      !eventSelectedInmueble ||
                      loading ||
                      loadingBtn ||
                      loadingBtnOII ||
                      loadingBtnOIICliente ||
                      loadingBtnSendIn
                    "
                    (click)="searchInmueble()"
                    class="btn btn-sm btn-block btn-primary active">
                    Buscar <i class="bx bx-search-alt bx-sm float-icon"></i>
                  </button>
                </div>
                <div class="col-sm-6 col-md-6">
                  <form-field
                    [control]="formInmueble.get('descriptionInmueble')"
                    label="Descripción">
                    <input
                      readonly
                      type="text"
                      class="form-control loading"
                      formControlName="descriptionInmueble" />
                  </form-field>
                </div>
                <div class="col-sm-2 col-lg-2">
                  <form-field [control]="formInmueble.get('eventInmueble')">
                    <ngx-select
                      [form]="formInmueble"
                      [searchOnInit]="true"
                      [data]="comerEventSelectInmueble"
                      value="id"
                      bindLabel="id"
                      label="Evento"
                      (fetchItems)="getComerEventsInmueble($event)"
                      control="eventInmueble"
                      (change)="selectEventInmueble($event)">
                    </ngx-select>
                  </form-field>
                </div>
              </div>
            </div>
          </div>
        </form>

        <div class="row mt-2">
          <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
            <div class="d-flex flex-row-reverse my-3">
              <div class="mb-2 col-2">
                <button
                  [disabled]="
                    loading ||
                    loadingBtn ||
                    totalItems == 0 ||
                    loadingBtnOII ||
                    loadingBtnOIICliente ||
                    loadingBtnSendIn
                  "
                  (click)="allNo()"
                  type="button"
                  tooltip="Cambiar Enviar Sirsae a NO"
                  containerClass="tooltip-style"
                  class="w-100 btn btn-block btn-primary btn-sm active">
                  Todos NO
                  <!-- <i class="bx bx-plus bx-sm float-icon"></i> -->
                </button>
              </div>
              <div class="mb-2 mr-2 col-2">
                <button
                  [disabled]="
                    loading ||
                    loadingBtn ||
                    totalItems == 0 ||
                    loadingBtnOII ||
                    loadingBtnOIICliente ||
                    loadingBtnSendIn
                  "
                  (click)="allYes()"
                  type="button"
                  tooltip="Cambiar Enviar Sirsae a SI"
                  containerClass="tooltip-style"
                  class="w-100 btn btn-block btn-success active btn-sm">
                  Todos SI
                  <!-- <i class="bx bx-plus bx-sm float-icon"></i> -->
                </button>
              </div>
              <div class="col-sm-2 col-md-2 col-xl-2">
                <button
                  *ngIf="layout == 'I'"
                  [ngClass]="{ loading: loadingBtnOIICliente }"
                  [disabled]="
                    loading ||
                    loadingBtn ||
                    !eventSelectedInmueble ||
                    loadingBtnOII ||
                    loadingBtnOIICliente ||
                    loadingBtnSendIn
                  "
                  (click)="obtenerOI()"
                  class="w-100 btn btn-sm btn-block btn-info active">
                  Obtener OI
                </button>
              </div>
              <div class="col-sm-2 col-md-2 col-xl-2 mr-2">
                <button
                  *ngIf="layout == 'I'"
                  [ngClass]="{ loading: loadingBtn }"
                  [disabled]="
                    loading ||
                    loadingBtn ||
                    !eventSelectedInmueble ||
                    loadingBtnOII ||
                    loadingBtnOIICliente ||
                    loadingBtnSendIn
                  "
                  type="button"
                  class="btn btn-primary btn-sm active btn-block"
                  tooltip="Enviar a SIRSAE"
                  containerClass="tooltip-style"
                  (click)="enviarSIRSAExCliente()">
                  Enviar x Cliente
                  <i *ngIf="!loadingBtn" class="bx bx-send"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <form-loader *ngIf="loading"></form-loader>
            <ng-scrollbar
              [track]="'all'"
              [ngStyle]="{ height: loading ? '0px' : '300px' }">
              <ng2-smart-table
                #myTable
                [attr.class]="'table-bordered'"
                [settings]="settings"
                [source]="data"
                (edit)="edit($event.data)"
                (userRowSelect)="selectClients($event.selected)">
              </ng2-smart-table>
            </ng-scrollbar>
            <app-pagination [params]="params" [totalItems]="totalItems">
            </app-pagination>
          </div>
          <!-- <div class="col-3">
            <div class="row justify-content-center text-center mt-2">
              <div class="col-md-6 mb-4">
                <button
                  [disabled]="loading || loadingBtn"
                  (click)="allNo()"
                  type="button"
                  tooltip="Cambiar Enviar Sirsae a NO"
                  containerClass="tooltip-style"
                  class="w-100 btn btn-primary btn-sm active mb-3">
                  Todos NO
                </button>
              </div>
              <div class="col-md-6 mb-4">
                <button
                  [disabled]="loading || loadingBtn"
                  (click)="allYes()"
                  type="button"
                  tooltip="Cambiar Enviar Sirsae a SI"
                  containerClass="tooltip-style"
                  class="w-100 btn btn-success active btn-sm mb-3">
                  Todos SI
                </button>
              </div>
            </div>
          </div> -->
        </div>
      </accordion-group>
    </accordion>
  </div>
</app-card>
