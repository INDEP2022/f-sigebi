<!-- <form class="form-material" [formGroup]="form" (ngSubmit)="onSubmit()">
  <div class="row pt-5">
    <div class="col-md-2" *ngIf="!show1">
      <app-events-shared
        [label]="'Evento'"
        [bindLabel]="'id'"
        [form]="form"></app-events-shared>
    </div>
    <div class="col-md-2 pt-3" *ngIf="!show1">
      <form-field [control]="form.get('idAllotment')" label="Lote">
        <input type="text" class="form-control" formControlName="idAllotment" />
      </form-field>
    </div>
    <div class="col-md-2">
      <button
        type="submit"
        class="btn btn-primary btn-sm active"
        [disabled]="!form.valid"
        (click)="show1 = !show1">
        Generar Prefacturas
      </button>
    </div>
    <div class="col-md-2" *ngIf="show1">
      <button
        type="button"
        class="btn btn-secondary btn-sm active"
        (click)="show1 = !show1">
        Actualizar Datos
      </button>
    </div>
  </div>
</form>

<div class="row" *ngIf="show1">
  <div class="ch-content">
    <h5 class="title">FACTURAS DEL EVENTO: {{ idAllotment }}</h5>
    <div class="row justify-content-end mr-3">
      <app-columns-select [(settings)]="settings"></app-columns-select>
    </div>
  </div>
  <div class="row pt-3">
    <div class="col-md-2 btn-group">
      <button
        type="button"
        class="btn btn-primary btn-sm active"
        (click)="sendPack()">
        Enviar paquetes
      </button>
    </div>
    <div class="col-md-2 btn-group">
      <button
        type="button"
        class="btn btn-success btn-sm active"
        (click)="exportAsXLSX()">
        Exportar a Excel
      </button>
    </div>
    <div class="col-md-2 btn-group">
      <button
        id="btnGroupImprimir"
        type="button"
        class="btn btn-danger btn-sm active dropdown-toggle"
        data-toggle="dropdown">
        Imprimir: <span class="bi bi-arrow-down-short"></span>
      </button>
      <div class="dropdown-menu" aria-labelledby="btnGroupExcel">
        <a class="dropdown-item" (click)="openPrevPdf()">imprime masivo .pdf</a>
        <a class="dropdown-item" (click)="openPrevPdf()">Factura</a>
        <a class="dropdown-item" (click)="openPrevPdf()">Anexo</a>
        <a class="dropdown-item" (click)="openPrevPdf()">CR</a>
        <a class="dropdown-item" (click)="openPrevPdf()">CE</a>
        
      </div>
    </div>
    <div class="col-md-2 btn-group">
      <button
        type="button"
        class="btn btn-info btn-sm active"
        (click)="openPrevPdf()">
        Generar CFDI
      </button>
    </div>
    <div class="col-md-2 btn-group">
      <button type="button" class="btn btn-secondary btn-sm active">
        Atenci&oacute;n a clientes
      </button>
    </div>
    <div class="col-md-2 btn-group">
      <button type="button" class="btn btn-secondary btn-sm active">
        Act. Matr&iacute;cula
      </button>
    </div>
  </div>
  <div class="row pt-3">
    <ng2-smart-table
      [source]="data"
      [settings]="settings"
      (edit)="openModal()"
      (delete)="delete()"
      (custom)="openPrevPdf()"></ng2-smart-table>
  </div>

  <div class="row pt-3">
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">Importe Egresos: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">0.00</h3>
    </div>
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">IVA Egreso: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">0.00</h3>
    </div>
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">Total Egresos: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">0.00</h3>
    </div>
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">Importe Ingresos: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">146,655.17</h3>
    </div>
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">IVA Ingresos: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">10,344.83</h3>
    </div>
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">Total Ingresos: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">157,000.00</h3>
    </div>
  </div>
</div>

<hr />

<div class="row pt-3" *ngIf="show1">
  <div class="ch-content">
    <h5 class="title">BIENES</h5>
    <div class="row justify-content-end mr-3">
      <app-columns-select [(settings)]="settings2"></app-columns-select>
    </div>
  </div>
  <div class="row pt-3">
    <ng2-smart-table [source]="data2" [settings]="settings2"></ng2-smart-table>
  </div>
  <div class="row pt-3">
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">N&uacute;mero de registros: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">1</h3>
    </div>
    <div class="col-md-3">
      <h5 class="font-size-14 d-inline">Total Importe: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">10,000.00</h3>
    </div>
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">Total IVA: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">0.00</h3>
    </div>
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">Total: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">10,000.00</h3>
    </div>
    <div class="col-md-3">
      <h5 class="font-size-14 d-inline">Cantidad Total Bienes: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">1</h3>
    </div>
  </div>
</div> -->

<form class="form-material" [formGroup]="form">
  <div class="row pt-5">
    <div class="col-12 col-md-2">
      <form-field [control]="form.get('event')" label="Evento">
        <input
          type="number"
          class="form-control"
          formControlName="event"
          oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)"
          (blur)="formG.emit(form)" />
      </form-field>
    </div>
    <div class="col-12 col-md-2">
      <form-field [control]="form.get('idAllotment')" label="Lote">
        <input
          type="number"
          class="form-control"
          formControlName="idAllotment"
          oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)"
          (blur)="formG.emit(form)" />
      </form-field>
    </div>
    <div class="col-12 col-md-2">
      <form-field [control]="form.get('date')" label="Fecha">
        <input
          type="text"
          class="form-control"
          bsDatepicker
          [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY' }"
          ControlName="date" />
      </form-field>
    </div>
    <div class="col-12 col-md-auto">
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2"
        (click)="exportAsXLSX()">
        Selec. Todos <i class="fas fa-edit bx-sm float-icon"></i>
      </button>
    </div>
    <div class="col-12 col-md-2">
      <form-field [control]="form.get('causerebillId')">
        <ngx-select
          (fetchItems)="getRebillData($event)"
          label="Causa Cancelación"
          [data]="dataRebill"
          [form]="form"
          value="id"
          bindLabel="id"
          [control]="'causerebillId'"
          [searchOnInit]="true"
          [searchable]="false"
          termMaxLength="30"
          [labelTemplate]="rebill"
          [optionTemplate]="rebillDesc"
          typeToSearchText="No hay más resultados">
        </ngx-select>
        <ng-template #rebill let-item="item">
          {{ item.id }} - {{ item.description }}
        </ng-template>
        <ng-template #rebillDesc let-item="item">
          <div [title]="item.id + ' - ' + item.description">
            {{ item.id }} - {{ item.description }}
          </div>
        </ng-template>
      </form-field>
    </div>
    <div class="col-12 col-md-auto">
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2"
        (click)="exportAsXLSX()">
        Anular
      </button>
    </div>
    <div class="col-12 col-md-auto">
      <form-check label="Solo Fact." for="label">
        <input
          id="label"
          type="checkbox"
          formControlName="check"
          (change)="disabledButtons()" />
      </form-check>
    </div>
    <div class="col-md-12">
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Genera Prefacturas <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="updateData()">
        Actualiza Datos <i class="fas fa-sync-alt"> </i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generateInvoice()">
        Genera Folios <i class="bx bxs-file"></i>
      </button>
      <button
        [disabled]="buttons"
        type="button"
        class="btn btn-red btn-sm active mr-2 mb-2"
        (click)="removeInvoice()">
        Eliminar Folios <i class="fa fa-trash" aria-hidden="true"></i>
      </button>
      <button
        [disabled]="buttons"
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Visualizar Factura <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Visualiza Anexo <i class="bx bxs-file"></i>
      </button>
      <button
        [disabled]="buttons"
        type="button"
        class="btn btn-danger btn-sm active mr-2 mb-2"
        (click)="exportAsXLSX()">
        Cancelar Factura
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Atención a Clientes <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Generar CDFI <i class="bx bxs-file"></i>
      </button>
      <button
        [disabled]="buttons"
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Obt. Imagen <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Imprime Factura <i class="bx bxs-file"></i>
      </button>
      <button
        [disabled]="buttons"
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Imprime Anexo <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Visualiza Anexo <i class="bx bxs-file"></i>
      </button>
      <button
        [disabled]="buttons"
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="openModal()">
        Asig. Manual Folios <i class="bx bx-plus bx-sm float-icon"></i>
      </button>
      <button
        [disabled]="buttons"
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Enviar Paquete <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="actMatricula()">
        Act. Matricula <i class="bx bxs-file"></i>
      </button>
      <!--Revisar con Carlos-->
      <button type="button" class="btn btn-primary active btn-sm mr-2 mb-2">
        Imprime Masivo .pdf <i class="bx bx-printer bx-sm float-icon"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Visualiza CR <i class="bx bxs-file"></i>
      </button>
      <button
        [disabled]="buttons"
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="impresionCR()">
        Imprime CR <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="visualizarCE()">
        Visualiza CE <i class="bx bxs-file"></i>
      </button>
      <button
        [disabled]="buttons"
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="impresionCE()">
        Imprime CE <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="track()">
        Tracto S/P <i class="bx bxs-file"></i>
      </button>
      <button type="button" class="btn btn-sm btn-success active mr-2 mb-2">
        Exportar a Excel
        <i class="bx bx-download float-icon"></i>
      </button>
    </div>
  </div>
</form>

<div class="row">
  <div class="ch-content">
    <h5 class="title">PREFACTURAS DEL EVENTO</h5>
    <div class="row justify-content-end mr-3">
      <app-columns-select
        [(settings)]="settings"
        [leftList]="true"></app-columns-select>
    </div>
  </div>
  <div class="row pt-3">
    <form-loader *ngIf="loading"></form-loader>
    <div>
      <ng2-smart-table
        [ngStyle]="{ height: loading ? '0px' : 'auto' }"
        [attr.class]="'table-bordered table-responsive mb-4'"
        [settings]="settings"
        [source]="dataFilter"
        (rowSelect)="getComerDetInvocie($event.data)">
      </ng2-smart-table>
    </div>
    <app-pagination [params]="paramsList" [totalItems]="totalItems">
    </app-pagination>
  </div>

  <form class="form-material" [formGroup]="formFactura">
    <div class="row pt-5">
      <div class="col-md-2">
        <form-field
          [control]="formFactura.get('importE')"
          label="Importe Egresos">
          <input
            type="number"
            class="form-control"
            formControlName="importE"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field [control]="formFactura.get('ivaE')" label="Iva Egresos">
          <input
            type="number"
            class="form-control"
            formControlName="ivaE"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field [control]="formFactura.get('totalE')" label="Total Egresos">
          <input
            type="number"
            class="form-control"
            formControlName="totalE"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field [control]="formFactura.get('count')" label="No. Factura">
          <input
            type="number"
            class="form-control"
            formControlName="count"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field
          [control]="formFactura.get('importI')"
          label="Importe Ingresos">
          <input
            type="number"
            class="form-control"
            formControlName="importI"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field [control]="formFactura.get('ivaI')" label="Iva Ingresos">
          <input
            type="number"
            class="form-control"
            formControlName="ivaI"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field
          [control]="formFactura.get('totalI')"
          label="Total Ingresos">
          <input
            type="number"
            class="form-control"
            formControlName="totalI"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
    </div>
  </form>

  <form class="form-material" [formGroup]="formDetalle">
    <div class="row pt-5">
      <div class="col-md-2">
        <form-field [control]="formFactura.get('count')" label="No. Registros">
          <input
            type="number"
            class="form-control"
            formControlName="count"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field [control]="formDetalle.get('totalI')" label="Total Importe">
          <input
            type="number"
            class="form-control"
            formControlName="totalI"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field [control]="formDetalle.get('totalIva')" label="Total Iva">
          <input
            type="number"
            class="form-control"
            formControlName="totalIva"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field [control]="formDetalle.get('total')" label="Total">
          <input
            type="number"
            class="form-control"
            formControlName="total"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field
          [control]="formDetalle.get('countTotal')"
          label="Cantidad Total Bienes">
          <input
            type="number"
            class="form-control"
            formControlName="countTotal"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
    </div>
  </form>

  <div class="row pt-3">
    <div class="col-12 d-flex justify-content-end pb-3">
      <app-columns-select
        [(settings)]="settings2"
        [leftList]="true"></app-columns-select>
    </div>
    <form-loader *ngIf="loading2"></form-loader>
    <div>
      <ng2-smart-table
        [ngStyle]="{ height: loading2 ? '0px' : 'auto' }"
        [attr.class]="'table-bordered table-responsive mb-4'"
        [settings]="settings2"
        [source]="dataFilter2">
      </ng2-smart-table>
    </div>
    <app-pagination [params]="paramsList2" [totalItems]="totalItems2">
    </app-pagination>
  </div>
</div>
