<app-card [header]="true" [footer]="true">
  <div header>
    <div class="ch-content">
      <h5 class="title">Proceso para rectificaci&oacute;n de facturas</h5>
    </div>
  </div>
  <div body>
    <div class="d-flex justify-content-end">
      <div class="d-inline">
        <button
          type="button"
          tooltip="Ver más coincidencias"
          class="btn btn-primary btn-sm active mr-3"
          [disabled]="!valResult"
          (click)="openModalSearch()">
          <i class="bx bx-list-plus bx-sm float-icon"></i>
        </button>
        <button
          text="Buscar"
          class="btn btn-primary btn-sm active mr-3"
          (click)="searchData()">
          Buscar
          <i class="bx bx-search-alt bx-sm float-icon"></i>
        </button>
        <button class="btn btn-danger btn-sm active mr-3" (click)="cleanData()">
          Limpiar <i class="fas fa-eraser"> </i>
        </button>
        <!-- <button type="button" class="btn btn-info btn-sm active" (click)="newData()">
          Nuevo <i class="bx bx-plus bx-sm float-icon"></i>
        </button> -->
      </div>
    </div>
    <form class="form-material mt-5" [formGroup]="form">
      <div class="row">
        <div class="col-md-3 mt-3">
          <!-- <div class="cs-form">
            <input type="time" class="form-control" value="10:05 AM" />
          </div> -->
          <form-field label="No. Oficio" [control]="form.get('jobNot')">
            <input
              [readonly]="dataJob"
              type="number"
              class="form-control"
              formControlName="jobNot"
              oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)"
              (blur)="getFirmantes()" />
          </form-field>
        </div>
        <div class="col-md-3 mt-3">
          <form-field [control]="form.get('expDate')" label="Fecha Expedición">
            <input
              [ngClass]="{ 'not-press bg-gray': dataJob }"
              type="text"
              class="form-control"
              bsDatepicker
              formControlName="expDate"
              [bsConfig]="{ isAnimated: true }"
              (ngModelChange)="setYear($event)" />
          </form-field>
        </div>
        <div class="col-md-3 mt-3">
          <form-field label="Serie" [control]="form.get('series')">
            <input
              type="text"
              class="form-control"
              formControlName="series"
              oninput="if(this.value.length > 2) this.value = this.value.slice(0, 2)"
              (blur)="postChangeFolio()" />
          </form-field>
        </div>
        <div class="col-md-3 mt-3">
          <form-field
            label="Folio de la Factura"
            [control]="form.get('Invoice')">
            <input
              type="number"
              class="form-control"
              formControlName="Invoice"
              oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)"
              (blur)="postChangeFolio()" />
          </form-field>
        </div>
        <div class="col-md-12 mt-3">
          <form-field label="Nombre" [control]="form.get('name')">
            <input
              type="text"
              class="form-control"
              formControlName="name"
              oninput="if(this.value.length > 100) this.value = this.value.slice(0, 100)" />
          </form-field>
        </div>
        <div class="col-md-6 mt-3">
          <form-field
            label="Apellido Paterno"
            [control]="form.get('lastnamePat')">
            <input
              type="text"
              class="form-control"
              formControlName="lastnamePat"
              oninput="if(this.value.length > 30) this.value = this.value.slice(0, 30)" />
          </form-field>
        </div>
        <div class="col-md-6 mt-3">
          <form-field
            label="Apellido Materno"
            [control]="form.get('lastnameMat')">
            <input
              type="text"
              class="form-control"
              formControlName="lastnameMat"
              oninput="if(this.value.length > 30) this.value = this.value.slice(0, 30)" />
          </form-field>
        </div>
        <div class="col-md-6 mt-3">
          <form-field
            label="Representante"
            [control]="form.get('inrepresentation')">
            <input
              type="text"
              class="form-control"
              formControlName="inrepresentation"
              oninput="if(this.value.length > 60) this.value = this.value.slice(0, 60)" />
          </form-field>
        </div>
        <div class="col-md-6 mt-3 text-center">
          <button
            text="Buscar"
            [disabled]="!dataJob"
            class="btn btn-info btn-sm active"
            (click)="openModal()">
            Nueva Imagen
            <i class="bx bx-plus bx-sm float-icon"></i>
          </button>
        </div>
      </div>
      <hr />
      <div class="ch-content">
        <h5 class="title">Datos de Atenci&oacute;n a clientes:</h5>
      </div>
      <div class="row pt-5">
        <div class="col-md-3 mt-3">
          <form-field label="Folio" [control]="form.get('InvoiceAttention')">
            <input
              type="text"
              class="form-control"
              formControlName="InvoiceAttention"
              oninput="if(this.value.length > 20) this.value = this.value.slice(0, 20)" />
          </form-field>
        </div>
        <div class="col-md-4 mt-3">
          <form-field [control]="form.get('attentionDate')" label="Fecha">
            <input
              type="text"
              class="form-control"
              bsDatepicker
              formControlName="attentionDate"
              [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY' }"
              (ngModelChange)="setParaghrapAll($event)" />
          </form-field>
        </div>
        <div class="col-md-4 mt-3">
          <form-field [control]="form.get('hourAttention')" label="Hora">
            <input
              type="text"
              class="form-control"
              bsDatepicker
              formControlName="hourAttention"
              [bsConfig]="{
                withTimepicker: true,
                dateInputFormat: 'DD/MM/YYYY h:mm a',
                keepDatepickerOpened: true
              }" />
            <!--keepDatepickerOpened: true,-->
          </form-field>
        </div>
        <div class="col-md-12 mt-3">
          <form-field label="Párrafo 1" [control]="form.get('paragraph1')">
            <textarea
              rows="4"
              class="form-control pt-2"
              formControlName="paragraph1"
              oninput="if(this.value.length > 800) this.value = this.value.slice(0, 800)"></textarea>
          </form-field>
        </div>
        <div class="col-md-12 mt-3">
          <form-field
            label="Documentos Presentados"
            [control]="form.get('documentspresented')">
            <input
              type="text"
              class="form-control"
              formControlName="documentspresented"
              oninput="if(this.value.length > 300) this.value = this.value.slice(0, 300)" />
          </form-field>
        </div>
        <div class="col-md-12 mt-3">
          <form-field label="Párrafo 3" [control]="form.get('paragraph3')">
            <textarea
              rows="4"
              class="form-control pt-2"
              formControlName="paragraph3"
              oninput="if(this.value.length > 100) this.value = this.value.slice(0, 100)"></textarea>
          </form-field>
        </div>
      </div>
    </form>
    <div class="row">
      <div class="d-flex justify-content-end">
        <div class="d-inline">
          <button
            type="button"
            [disabled]="!dataJob"
            class="btn btn-info btn-sm active mb-3"
            (click)="openModalSeparate()">
            Nuevo <i class="bx bx-plus bx-sm float-icon"></i>
          </button>
        </div>
      </div>
      <form-loader *ngIf="loading"></form-loader>
      <div>
        <ng2-smart-table
          [ngStyle]="{ height: loading ? '0px' : 'auto' }"
          [attr.class]="'table-bordered table-responsive mb-4'"
          [settings]="settings"
          [source]="dataFilter"
          (edit)="openModalSeparate($event.data)"
          (delete)="remove($event.data)">
        </ng2-smart-table>
      </div>
      <app-pagination
        [params]="paramsList"
        [totalItems]="totalItems"></app-pagination>
    </div>
    <form class="form-material mt-5" [formGroup]="form">
      <div class="row">
        <div class="col-md-12">
          <form-field label="Párrafo 4" [control]="form.get('paragraph4')">
            <textarea
              rows="4"
              class="form-control pt-2"
              formControlName="paragraph4"
              oninput="if(this.value.length > 600) this.value = this.value.slice(0, 600)"></textarea>
          </form-field>
        </div>
        <div class="col-md-4 mt-3">
          <form-field [control]="form.get('elaborates')">
            <ngx-select
              [data]="dataElabora"
              [searchOnInit]="false"
              (fetchItems)="getParamElabora($event)"
              [form]="form"
              value="valor"
              bindLabel="valor"
              label="Elabora"
              [control]="'elaborates'"
              [searchable]="true">
            </ngx-select>
            <!-- <ng-template #elb let-item="item">
              {{ item.value }}
            </ng-template>
            <ng-template #elbd let-item="item">
              <div [title]="item.value">
                {{ item.valor }}
              </div>
            </ng-template> -->
          </form-field>
        </div>
        <div class="col-md-4 mt-3">
          <form-field [control]="form.get('check')">
            <ngx-select
              [data]="dataVerifica"
              [searchOnInit]="false"
              (fetchItems)="getParamVerifica($event)"
              [form]="form"
              value="valor"
              bindLabel="valor"
              label="Verifica"
              [control]="'check'"
              [searchable]="true">
            </ngx-select>
            <!-- <ng-template #verf let-item="item">
              {{ item.value }}
            </ng-template>
            <ng-template #verfd let-item="item">
              <div [title]="item.value">
                {{ item.value }}
              </div>
            </ng-template> -->
          </form-field>
        </div>
        <div class="col-md-4 mt-3">
          <form-field [control]="form.get('issues')">
            <ngx-select
              [data]="dataExpide"
              [searchOnInit]="false"
              (fetchItems)="getParamExpide($event)"
              [form]="form"
              value="valor"
              bindLabel="valor"
              label="Expide"
              [control]="'issues'"
              [searchable]="true">
            </ngx-select>
            <!-- <ng-template #exp let-item="item">
              {{ item.value }}
            </ng-template>
            <ng-template #expd let-item="item">
              <div [title]="item.value">
                {{ item.value }}
              </div>
            </ng-template> -->
          </form-field>
        </div>
      </div>
    </form>
  </div>
  <div footer>
    <div class="ch-content">
      <h5 class="title"></h5>
      <div class="col-md-12 d-flex justify-content-center text-center buttons">
        <div class="d-inline">
          <button
            type="button"
            class="btn btn-primary btn-sm active"
            [disabled]="!form.valid"
            (click)="saveData()">
            Guardar
            <i aria-hidden="true" class="fa fa-save"></i>
          </button>
          <button
            type="button"
            class="btn btn-primary btn-sm active ml-3"
            (click)="openPrevPdf()">
            Reporte <i class="fa fa-file"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</app-card>
<div
  #modal="bs-modal"
  [config]="{ ignoreBackdropClick: true }"
  bsModal
  class="modal fade w-100">
  <app-modal class="modal-dialog modalSizeXL modal-dialog-centered">
    <div header>
      <h5 class="modal-title">
        &nbsp;&nbsp;Procesos de Rectificación de Facturas
      </h5>
    </div>
    <div body>
      <div class="row">
        <div class="col-12 d-flex justify-content-end pb-3">
          <app-columns-select
            [(settings)]="_settings"
            [leftList]="true"></app-columns-select>
        </div>
        <form-loader *ngIf="loading2"></form-loader>
        <div>
          <ng2-smart-table
            [ngStyle]="{
              height: loading2 ? '0px' : totalItems2 > 10 ? '300px' : 'auto'
            }"
            [attr.class]="'table-bordered table-responsive mb-4'"
            (userRowSelect)="selectRow($event)"
            [settings]="_settings"
            [source]="dataFilter2"
            (delete)="removeOficio($event.data)">
          </ng2-smart-table>
        </div>
        <div class="overflow-auto card-header-span-fix mt-5">
          <app-pagination
            [filterParams]="filterParams"
            [totalItems]="totalItems2">
          </app-pagination>
        </div>
      </div>
    </div>
    <div footer>
      <div class="d-flex justify-content-center">
        <div class="m-3">
          <button
            type="button"
            class="btn btn-sm btn-primary active"
            [disabled]="!rowSelected"
            (click)="confirm()">
            Seleccionar
            <i class="fas fa-edit bx-sm float-icon"></i>
          </button>
        </div>
        <div class="m-3">
          <button
            type="button"
            class="btn btn-danger btn-sm active"
            (click)="close()">
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </app-modal>
</div>
