<form class="form-material" [formGroup]="form">
  <div class="row pt-5">
    <div class="col-12 col-md-auto">
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generatePreFacture()">
        Genera Prefacturas <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="updateData()">
        Actualiza Datos <i class="fas fa-sync-alt"> </i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="generateInvoice()">
        Genera Folios <i class="bx bxs-file"></i>
      </button>
      <button
        type="button"
        class="btn btn-red btn-sm active mr-2 mb-2"
        (click)="removeInvoice()">
        Eliminar Folios <i class="fa fa-trash" aria-hidden="true"></i>
      </button>
      <button
        type="button"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        (click)="openModal()">
        Asig. Manual Folios <i class="bx bx-plus bx-sm float-icon"></i>
      </button>
      <button
        type="button"
        class="btn btn-danger btn-sm active mr-2 mb-2"
        (click)="exportAsXLSX()">
        Cancelar Factura
      </button>
      <button type="button" class="btn btn-primary btn-sm active mr-2 mb-2">
        Visualiza Prefactura <i class="fa fa-eye" aria-hidden="true"></i>
      </button>
      <button type="button" class="btn btn-primary active btn-sm mr-2 mb-2">
        Imprime Factura <i class="bx bx-printer bx-sm float-icon"></i>
      </button>
      <button type="button" class="btn btn-sm btn-success active mr-2 mb-2">
        Exportar a Excel
        <i class="bx bx-download float-icon"></i>
      </button>
      <button
        type="submit"
        class="btn btn-primary btn-sm active mr-2 mb-2"
        tooltip="Enviar"
        containerClass="tooltip-style">
        Enviar Paquete <i class="bx bx-send"></i>
      </button>
    </div>
    <div class="row mt-4">
      <div class="col-md-2">
        <form-field [control]="form.get('event')" label="Evento">
          <input
            type="number"
            class="form-control"
            formControlName="event"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field [control]="form.get('idAllotment')" label="Lote">
          <input
            type="number"
            class="form-control"
            formControlName="idAllotment"
            oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
        </form-field>
      </div>
      <div class="col-md-1">
        <form-field [control]="form.get('iva')">
          <ngx-select
            [data]="dataIva"
            [form]="form"
            value="id"
            bindLabel="val"
            label="Gen Iva"
            [control]="'iva'"
            [searchable]="false">
          </ngx-select>
        </form-field>
      </div>
      <div class="col-md-2">
        <form-field [control]="form.get('date')" label="Fecha">
          <input
            type="text"
            class="form-control"
            bsDatepicker
            [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY' }"
            ControlName="date" />
        </form-field>
      </div>
      <div class="col-auto">
        <button
          type="button"
          class="btn btn-primary btn-sm active mr-2"
          (click)="allSelect()">
          Selec. Todos <i class="fas fa-edit bx-sm float-icon"></i>
        </button>
      </div>
      <div class="col-md-2">
        <form-field [control]="form.get('causerebillId')">
          <ngx-select
            (fetchItems)="getRebillData($event)"
            label="Causa Cancelación"
            [data]="dataRebill"
            [form]="form"
            value="id"
            bindLabel="id"
            [control]="'causerebillId'"
            [searchOnInit]="true"
            [searchable]="false"
            termMaxLength="30"
            [labelTemplate]="rebill"
            [optionTemplate]="rebillDesc"
            typeToSearchText="No hay más resultados">
          </ngx-select>
          <ng-template #rebill let-item="item">
            {{ item.id }} - {{ item.description }}
          </ng-template>
          <ng-template #rebillDesc let-item="item">
            <div [title]="item.id + ' - ' + item.description">
              {{ item.id }} - {{ item.description }}
            </div>
          </ng-template>
        </form-field>
      </div>
      <div class="col-auto">
        <button
          type="button"
          class="btn btn-primary btn-sm active mr-2"
          (click)="exportAsXLSX()">
          Anular
        </button>
      </div>
    </div>
  </div>
</form>

<div class="row">
  <div class="ch-content">
    <h5 class="title">PREFACTURAS DEL EVENTO</h5>
    <div class="row justify-content-end mr-3">
      <app-columns-select
        [(settings)]="settings"
        [leftList]="true"></app-columns-select>
    </div>
  </div>
  <div class="row pt-3">
    <form-loader *ngIf="loading"></form-loader>
    <div>
      <ng2-smart-table
        #table
        [ngStyle]="{
          height: loading ? '0px' : totalItems > 10 ? '600px' : 'auto'
        }"
        [attr.class]="'table-bordered table-responsive mb-4'"
        [settings]="settings"
        [source]="dataFilter">
      </ng2-smart-table>
    </div>
    <app-pagination
      [params]="paramsList"
      [totalItems]="totalItems"
      [limit]="limit"
      [pageSizeOptions]="[500]">
    </app-pagination>
  </div>
  <div class="row">
    <form class="form-material" [formGroup]="form">
      <div class="row justify-content-end">
        <div class="col-md-2">
          <form-field [control]="form.get('price')">
            <input
              type="string"
              class="form-control"
              formControlName="price"
              currencyMask
              oninput="if(this.value.length > 20) this.value = this.value.slice(0, 20)" />
          </form-field>
        </div>
        <div class="col-md-2">
          <form-field [control]="form.get('ivaT')">
            <input
              type="string"
              class="form-control"
              formControlName="ivaT"
              currencyMask
              oninput="if(this.value.length > 20) this.value = this.value.slice(0, 20)" />
          </form-field>
        </div>
        <div class="col-md-2">
          <form-field [control]="form.get('total')">
            <input
              type="string"
              class="form-control"
              formControlName="total"
              currencyMask
              oninput="if(this.value.length > 20) this.value = this.value.slice(0, 20)" />
          </form-field>
        </div>
      </div>
    </form>
  </div>

  <div class="row pt-3">
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">N&uacute;mero de facturas: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">&nbsp; 3</h3>
    </div>
  </div>
</div>
