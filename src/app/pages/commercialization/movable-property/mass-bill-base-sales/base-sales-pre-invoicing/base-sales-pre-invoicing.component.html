<app-card [header]="false" [footer]="false">
  <div body style="margin-bottom: 0px !important">
    <accordion style="margin-bottom: 0px !important" [isAnimated]="true">
      <accordion-group
        style="margin-bottom: 0px !important"
        [isOpen]="true"
        [class.disabled]="false">
        <div accordion-heading class="d-flex justify-content-between">
          <h5>ACCIONES</h5>
        </div>
        <form class="form-material" [formGroup]="form">
          <div class="row mt-3">
            <div class="col-md-3">
              <form-field [control]="form.get('event')" label="Evento">
                <input
                  type="number"
                  class="form-control"
                  formControlName="event"
                  oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
              </form-field>
            </div>
            <div class="col-md-3">
              <form-field [control]="form.get('idAllotment')" label="Lote">
                <input
                  type="number"
                  class="form-control"
                  formControlName="idAllotment"
                  oninput="if(this.value.length > 11) this.value = this.value.slice(0, 11)" />
              </form-field>
            </div>
            <div class="col-md-3">
              <form-field [control]="form.get('iva')">
                <ngx-select
                  [data]="dataIva"
                  [form]="form"
                  value="id"
                  bindLabel="val"
                  label="Gen Iva"
                  [control]="'iva'"
                  [searchable]="false">
                </ngx-select>
              </form-field>
            </div>
            <div class="col-md-3">
              <form-field [control]="form.get('date')" label="Fecha">
                <input
                  type="text"
                  class="form-control"
                  bsDatepicker
                  [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY' }"
                  ControlName="date" />
              </form-field>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-3">
              <div class="row">
                <div class="col-12">
                  <button
                    [ngClass]="{ loading: btnLoading }"
                    [disabled]="btnLoading"
                    type="button"
                    class="btn btn-primary btn-block btn-sm active mr-2 mb-2"
                    (click)="generatePreFacture()">
                    Genera Prefacturas
                    <i *ngIf="!btnLoading" class="bx bxs-file"></i>
                  </button>
                </div>
                <div class="col-12">
                  <button
                    [ngClass]="{ loading: btnLoading2 }"
                    [disabled]="btnLoading2"
                    type="button"
                    class="btn btn-primary btn-block btn-sm active mr-2 mb-2"
                    (click)="generateInvoice()">
                    Genera Folios
                    <i *ngIf="!btnLoading2" class="bx bxs-file"></i>
                  </button>
                </div>
                <div class="col-12">
                  <button
                    [ngClass]="{ loading: btnLoading3 }"
                    [disabled]="btnLoading3"
                    type="button"
                    class="btn btn-block btn-red btn-sm active mr-2 mb-2"
                    (click)="removeInvoice()">
                    Eliminar Folios
                    <i
                      *ngIf="!btnLoading3"
                      class="fa fa-trash"
                      aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="col-3">
              <div class="row">
                <div class="col-12">
                  <button
                    [ngClass]="{ loading: btnLoading4 }"
                    [disabled]="btnLoading4"
                    type="button"
                    class="btn btn-primary btn-block btn-sm active mr-2 mb-2"
                    (click)="updateData()">
                    Actualiza Datos
                    <i *ngIf="!btnLoading4" class="fas fa-sync-alt"> </i>
                  </button>
                </div>
                <div class="col-12">
                  <button
                    [ngClass]="{ loading: btnLoading5 }"
                    [disabled]="btnLoading5"
                    type="button"
                    class="btn btn-block btn-primary btn-sm active mr-2 mb-2"
                    (click)="openModal()">
                    Asig. Manual Folios
                    <i
                      *ngIf="!btnLoading5"
                      class="bx bx-plus bx-sm float-icon"></i>
                  </button>
                </div>
                <div class="col-12">
                  <button
                    [ngClass]="{ loading: btnLoading6 }"
                    [disabled]="btnLoading6"
                    type="button"
                    class="btn btn-block btn-danger btn-sm active mr-2 mb-2"
                    (click)="cancelInvoice()">
                    Cancelar Factura
                  </button>
                </div>
              </div>
            </div>
            <div class="col-3">
              <div class="row">
                <div class="col-12">
                  <button
                    [ngClass]="{ loading: btnLoading7 }"
                    [disabled]="btnLoading7"
                    type="button"
                    (click)="visualInvoice()"
                    class="btn btn-block btn-primary btn-sm active mr-2 mb-2">
                    Visualiza Prefactura
                    <i class="fa fa-eye" aria-hidden="true"></i>
                  </button>
                </div>
                <div class="col-12">
                  <button
                    [ngClass]="{ loading: btnLoading8 }"
                    [disabled]="btnLoading8"
                    (click)="printInvoice()"
                    type="button"
                    class="btn btn-block btn-primary active btn-sm mr-2 mb-2">
                    Imprime Factura
                    <i class="bx bx-printer bx-sm float-icon"></i>
                  </button>
                </div>
                <div class="col-12">
                  <button
                    (click)="exportExcel()"
                    [ngClass]="{ loading: btnLoading13 }"
                    [disabled]="btnLoading13"
                    type="button"
                    class="btn btn-block btn-sm btn-success active mr-2 mb-2">
                    Exportar a Excel
                    <i
                      *ngIf="!btnLoading13"
                      class="bx bx-download float-icon"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="col-3">
              <div class="row">
                <div class="col-12">
                  <button
                    type="button"
                    class="btn btn-block btn-primary btn-sm active mr-2 mb-2"
                    (click)="allSelect()">
                    Selec. Todos <i class="fas fa-edit bx-sm float-icon"></i>
                  </button>
                </div>
                <!-- <div class="col-12">
                  <button
                    (click)="sendPackage()"
                    class="btn btn-primary btn-block btn-sm active mr-2 mb-2"
                    tooltip="Enviar"
                    containerClass="tooltip-style">
                    Enviar Paquete <i class="bx bx-send"></i>
                  </button>
                </div> -->
              </div>
            </div>
          </div>
          <div class="row mt-5 text-center justify-content-center">
            <div class="col-4">
              <form-field
                *ngIf="disabledCause"
                [control]="form.get('causerebillId')">
                <ngx-select
                  (fetchItems)="getRebillData($event)"
                  label="Causa Cancelación"
                  [data]="dataRebill"
                  [form]="form"
                  value="id"
                  bindLabel="id"
                  [control]="'causerebillId'"
                  [searchOnInit]="true"
                  [searchable]="false"
                  termMaxLength="30"
                  [labelTemplate]="rebill"
                  [optionTemplate]="rebillDesc"
                  typeToSearchText="No hay más resultados">
                </ngx-select>
                <ng-template #rebill let-item="item">
                  {{ item.id }} - {{ item.description }}
                </ng-template>
                <ng-template #rebillDesc let-item="item">
                  <div [title]="item.id + ' - ' + item.description">
                    {{ item.id }} - {{ item.description }}
                  </div>
                </ng-template>
              </form-field>
            </div>
            <div class="col-2">
              <button
                *ngIf="disabledRegCanc"
                [disabled]="!disabledRegCanc"
                type="button"
                class="btn btn-block btn-primary btn-sm active mr-2"
                (click)="regCanc()">
                Anular
              </button>
            </div>
          </div>
        </form>
      </accordion-group>
    </accordion>
  </div>
</app-card>

<div class="row">
  <div class="ch-content">
    <h5 class="title">PREFACTURAS DEL EVENTO</h5>
    <div class="row justify-content-end mr-3">
      <app-columns-select
        [(settings)]="settings"
        [leftList]="true"></app-columns-select>
    </div>
  </div>
  <div class="row pt-3">
    <form-loader *ngIf="loading"></form-loader>
    <div>
      <ng2-smart-table
        #table
        [ngStyle]="{
          height: loading ? '0px' : totalItems > 10 ? '600px' : 'auto'
        }"
        [attr.class]="'table-bordered table-responsive mb-4'"
        [settings]="settings"
        (userRowSelect)="rowsSelected($event)"
        [source]="dataFilter">
      </ng2-smart-table>
    </div>
    <app-pagination
      [params]="paramsList"
      [totalItems]="totalItems"
      [limit]="limit"
      [pageSizeOptions]="[500]">
    </app-pagination>
  </div>
  <div class="row">
    <form class="form-material" [formGroup]="form">
      <div class="row justify-content-end">
        <div class="col-md-3">
          <form-field
            [control]="form.get('numberInvoices')"
            label="N&uacute;mero de facturas: &nbsp;:">
            <input
              readonly
              type="text"
              [(ngModel)]="totalItems"
              class="form-control"
              formControlName="numberInvoices" />
          </form-field>
        </div>
        <div class="col-md-3">
          <form-field [control]="form.get('order')" label="Ordenar por:">
            <ng-select
              (change)="changeOpt($event)"
              formControlName="order"
              class="form-control">
              <ng-option value="1">LOTE</ng-option>
              <ng-option value="2">REGIONAL</ng-option>
              <ng-option value="4">FOLIO</ng-option>
            </ng-select>
          </form-field>
        </div>
        <div class="col-md-2">
          <form-field [control]="form.get('price')">
            <input
              readonly
              type="string"
              class="form-control"
              formControlName="price"
              currencyMask
              oninput="if(this.value.length > 20) this.value = this.value.slice(0, 20)" />
          </form-field>
        </div>
        <div class="col-md-2">
          <form-field [control]="form.get('ivaT')">
            <input
              readonly
              type="string"
              class="form-control"
              formControlName="ivaT"
              currencyMask
              oninput="if(this.value.length > 20) this.value = this.value.slice(0, 20)" />
          </form-field>
        </div>
        <div class="col-md-2">
          <form-field [control]="form.get('total')">
            <input
              readonly
              type="string"
              class="form-control"
              formControlName="total"
              currencyMask
              oninput="if(this.value.length > 20) this.value = this.value.slice(0, 20)" />
          </form-field>
        </div>
      </div>
    </form>
  </div>

  <!-- <div class="row pt-3">
    <div class="col-md-2">
      <h5 class="font-size-14 d-inline">N&uacute;mero de facturas: &nbsp;</h5>
      <h3 class="font-size-14 d-inline">&nbsp; 3</h3>
    </div>
  </div> -->
</div>
