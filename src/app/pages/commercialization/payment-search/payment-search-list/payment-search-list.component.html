<app-card [header]="true">
  <div class="ch-content" header>
    <h5 class="title">b&uacute;squeda y procesamiento de pagos</h5>
  </div>
  <div body>
    <div class="row">
      <form class="form-material mb-0" [formGroup]="searchForm">
        <div class="row">
          <div class="col-sm-6 col-md-3">
            <form-field [control]="searchForm.get('event')" label="Evento">
              <input type="text" formControlName="event" class="form-control" />
            </form-field>
          </div>
          <div class="col-sm-6 col-md-3">
            <form-field [control]="searchForm.get('batch')" label="Lote">
              <input type="text" formControlName="batch" class="form-control" />
            </form-field>
          </div>
          <div class="col-sm-6 col-md-3">
            <form-field [control]="searchForm.get('bank')" label="Banco">
              <ng-custom-select
                formControlName="bank"
                class="form-control"
                path="interfacesirsae/api/v1/banks-sirsae"
                paramSearch="filter.name_bank"
                prefixSearch="$ilike"
                value="name_bank">
                <ng-template let-item>{{ item.name_bank }}</ng-template>
              </ng-custom-select>
            </form-field>
          </div>
          <div class="col-sm-6 col-md-3">
            <form-field [control]="searchForm.get('amount')" label="Monto">
              <input
                type="number"
                formControlName="amount"
                class="form-control" />
            </form-field>
          </div>
        </div>
        <div class="row mt-5">
          <div class="col-sm-6 col-md-3">
            <form-field
              [control]="searchForm.get('reference')"
              label="Referencia">
              <input
                type="text"
                formControlName="reference"
                class="form-control" />
            </form-field>
          </div>
          <div class="col-sm-6 col-md-3">
            <form-field
              [control]="searchForm.get('validity')"
              label="Válido Sistema">
              <ng-select
                formControlName="validity"
                [searchable]="false"
                class="form-control"
                [clearable]="false">
                <ng-option value="1">NULO</ng-option>
                <ng-option value="2">B</ng-option>
              </ng-select>
            </form-field>
          </div>
          <div class="col-sm-6 col-md-3">
            <form-field
              [control]="searchForm.get('searchType')"
              label="Tipo de Búsqueda">
              <ng-select
                formControlName="searchType"
                [searchable]="false"
                class="form-control"
                [clearable]="false">
                <ng-option value="0">Normales</ng-option>
                <ng-option value="1">Duplicados</ng-option>
                <ng-option value="2">No Referenciados</ng-option>
                <ng-option value="3">Efectivo</ng-option>
                <ng-option value="4">Inconsistencia</ng-option>
                <ng-option value="5">Carga de Archivo CSV</ng-option>
              </ng-select>
            </form-field>
          </div>
          <div class="col-sm-6 col-md-3">
            <form-field [control]="searchForm.get('system')" label="Sistema">
              <ng-select
                formControlName="system"
                [searchable]="false"
                class="form-control"
                [clearable]="false">
                <ng-option value="1">SIAB</ng-option>
                <ng-option value="2">SIRSAE</ng-option>
              </ng-select>
            </form-field>
          </div>
        </div>
        <div class="row mb-4">
          <div class="col-md-12-col-sm12 col-xs-12 text-center">
            <button
              class="btn btn-primary active btn-sm"
              (click)="search()"
              [disabled]="!searchForm.valid">
              Buscar <i class="bx bx-search-alt bx-sm float-icon"></i>
            </button>
            <button
              class="btn btn-red btn-sm active m-3"
              (click)="formClean()"
              [disabled]="!searchForm.valid">
              Limpiar
              <i class="fa fa-trash" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </form>
    </div>

    <div class="row">
      <form class="form-material mb-0" [formGroup]="searchForm">
        <div class="col-md-12 col-sm-12 text-center">
          <div class="col-md-3">
            <input id="typeId" name="typeId" type="hidden" value="" />
            <form-field [control]="searchForm.get('type')" label="Tipo">
              <input
                type="text"
                formControlName="type"
                readonly="true"
                class="form-control" />
            </form-field>
          </div>
          <div class="col-md-3">
            <form-field
              [control]="searchForm.get('processType')"
              label="Tipo de Proceso">
              <ng-select
                formControlName="processType"
                [searchable]="false"
                class="form-control"
                [clearable]="false">
                <ng-option value="0">Normales</ng-option>
                <ng-option value="1">Duplicados</ng-option>
                <ng-option value="2">No Referenciados</ng-option>
                <ng-option value="3">Efectivo</ng-option>
                <ng-option value="4">Inconsistencia</ng-option>
                <ng-option value="5">Carga de Archivo CSV</ng-option>
              </ng-select>
            </form-field>
          </div>
          <div class="col-md-2">
            <form-field [control]="searchForm.get('action')" label="Acción">
              <ng-select
                formControlName="action"
                [searchable]="false"
                class="form-control"
                [clearable]="false">
                <ng-option value="1">Cancelar</ng-option>
                <ng-option value="2">Actualizar</ng-option>
                <ng-option value="3">Registrar</ng-option>
              </ng-select>
            </form-field>
          </div>
        </div>
      </form>
    </div>

    <br />
    <div class="row">
      <div class="col-md-12-col-sm12 text-center">
        <button
          type="button"
          class="btn btn-sm btn-info active m-3"
          (click)="aplica()">
          <i class="bx bx-file text-light float-icon"></i>
          Aplica
        </button>
        <button
          class="btn btn-sm btn-success active m-3"
          (click)="loadCSV.click()">
          <i class="bi bi-file-earmark-excel-fill"></i>
          Carga de CSV<input
            #loadCSV
            hidden
            type="file"
            accept=".csv"
            (change)="procesa()" />
        </button>
        <button
          class="btn btn-red btn-sm active m-3"
          (click)="cleanSearch()"
          [disabled]="!searchForm.valid">
          Eliminar B&uacute;squeda
          <i class="fa fa-trash" aria-hidden="true"></i>
        </button>
        <button type="button" class="btn btn-sm btn-info active m-3">
          <i class="bx bx-file text-light float-icon"></i>
          Cambio de Proceso
        </button>
        <button
          class="btn btn-primary btn-sm active mr-3"
          (click)="getCsv($event)">
          <i class="fas fa-sync-alt"></i>
          Cambiar Lotes
        </button>
      </div>
    </div>
    <div class="row mt-2">
      <!-- <div class="col-sm-3 col-md-3">
        <div class="form-material">
          <form-field [control]="searchForm.get('type')" label="Tipo">
            <input type="text" formControlName="type" class="form-control" />
          </form-field>
        </div>
      </div>
      <br /> -->
      <div class="row mb-4">
        <div class="col-md-12-col-sm12 col-xs-12 text-center">
          <!-- <button
            class="btn btn-primary btn-sm active mr-3"
            (click)="loadBatch.click()">
            <i class="fas fa-sync-alt"></i>
            Cambiar Lotes<input
              #loadBatch
              hidden
              type="file"
              accept=".csv"
              (change)="getCsv($event)" />
          </button> -->
        </div>
      </div>
      <div class="col-sm-12 col-md-12">
        <div class="d-flex flex-row-reverse my-3">
          <div class="">
            <app-columns-select
              [(settings)]="paymentSettings"></app-columns-select>
          </div>
          <div>
            <button
              class="btn btn-sm btn-success active me-2 font-size-14"
              (click)="openForm()"
              [disabled]="!searchForm.valid">
              <i class="bx bx-plus text-light float-icon"></i>
              Agregar Registro
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-12">
        <ng-scrollbar
          [track]="'horizontal'"
          [autoHeightDisabled]="false"
          class="table-scrollbar">
          <div [class]="loading ? 'table-loading' : ''">
            <ng2-smart-table
              id="consultation-table"
              [attr.class]="'table-bordered'"
              [settings]="paymentSettings"
              [source]="localdata"
              (edit)="openForm($event.data)"
              (userRowSelect)="selectRows($event.selected)">
            </ng2-smart-table>
          </div>
          <div class="table-padding"></div>
        </ng-scrollbar>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12 text-center">
        <div>
          <button
            class="btn btn-sm btn-success active me-2 font-size-14"
            (click)="systemAplicado()"
            [disabled]="false">
            Aplicado
          </button>
        </div>
      </div>
    </div>
    <app-pagination [params]="params" [totalItems]="totalItems">
    </app-pagination>
  </div>
</app-card>
