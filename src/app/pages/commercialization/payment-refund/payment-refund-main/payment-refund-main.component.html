<app-card [header]="true">
  <div #scrollContainer class="ch-content" header>
    <h5 class="title">Devolución de Pagos</h5>
  </div>
  <div body>
    <div *ngIf="layout == 'MAIN'" @OnInOut>
      <div class="row mt-5">
        <div class="col-md-12 d-flex flex-row-reverse mb-3">
          <div>
            <div class="btn-group mt-0 me-2" placement="bottom right" dropdown>
              <button
                [disabled]="btnLoadingCSV"
                #actionsBtn
                dropdownToggle
                type="button"
                class="btn btn-sm btn-success btn-block active me-2 font-size-14 dropdown-toggle"
                aria-controls="dropdown-actions">
                Archivos CSV <span class="caret"></span>
              </button>
              <ul
                id="dropdown-csv"
                *dropdownMenu
                class="dropdown-menu dropdown-menu-right"
                role="menu"
                aria-labelledby="processBtn">
                <li role="menuitem">
                  <a
                    class="dropdown-item bg-success text-light"
                    (click)="generateFile1()"
                    >Archivo CSV de Relaci&oacute;n de Devoluciones de
                    Garant&iacute;a de Seriedad</a
                  >
                </li>
                <li role="menuitem">
                  <a
                    class="dropdown-item bg-success text-light"
                    (click)="generateFile2()"
                    >Genera Archivos de Pagos y Transferencias</a
                  >
                </li>
                <li role="menuitem">
                  <a
                    class="dropdown-item bg-success text-light"
                    (click)="referenceRequestExpensesPayments()"
                    >Archivo CSV de Referencias de Solicitudes de Gastos y
                    Pagos</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="md-tabs mt-3" #tabsContainer>
          <tabset #refundTabs>
            <tab heading="Control de Devoluciones" id="controlTab">
              <div class="row mt-3">
                <div class="col-sm-12 col-md-8">
                  <h5 class="title">Control de Devoluciones</h5>
                </div>
                <div class="col-sm-12 col-md-4">
                  <div class="d-flex flex-row-reverse">
                    <div>
                      <app-columns-select
                        [(settings)]="controlSettings"></app-columns-select>
                    </div>
                  </div>
                </div>
                <div class="col-12" name="COMER_CTLDEVPAG_H">
                  <form-loader *ngIf="loadingControl"></form-loader>
                  <ng-scrollbar
                    [track]="'all'"
                    [ngStyle]="{ height: loadingControl ? '0px' : '400px' }">
                    <ng2-smart-table
                      id="controlTable"
                      [settings]="controlSettings"
                      [source]="dataTableControl"
                      (userRowSelect)="selectControl($event)">
                    </ng2-smart-table>
                  </ng-scrollbar>
                  <app-pagination
                    [params]="dataTableParamsControl"
                    [totalItems]="totalControl">
                  </app-pagination>
                </div>
              </div>
              <div class="row mt-4">
                <form class="form-material" [formGroup]="controlForm">
                  <div class="row d-flex justify-content-center">
                    <div class="col-md-2">
                      <div class="d-flex justify-content-end pt-3">
                        <!-- <div> -->
                        <label><strong>Visualizar:</strong></label>
                        <!-- </div> -->
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="d-flex justify-content-beetwen">
                        <div>
                          <form-radio label="En Proceso">
                            <input
                              type="radio"
                              class="d-inline"
                              formControlName="filter"
                              (change)="filter($event)"
                              value="P" />
                          </form-radio>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="d-flex justify-content-beetwen">
                        <div>
                          <form-radio label="Concluidos">
                            <input
                              type="radio"
                              class="d-inline"
                              formControlName="filter"
                              (change)="filter($event)"
                              value="C" />
                          </form-radio>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="d-flex justify-content-beetwen">
                        <div>
                          <form-radio label="Todos">
                            <input
                              type="radio"
                              class="d-inline"
                              formControlName="filter"
                              (change)="filter($event)"
                              value="I" />
                          </form-radio>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </tab>
            <tab heading="Eventos Relacionados" id="eventsTab">
              <div class="row mt-3">
                <div class="col-sm-12 col-md-12">
                  <h5 class="title">Eventos Relacionados</h5>
                </div>
                <div class="col-12" name="COMER_CTLDEVPAG_E">
                  <form-loader *ngIf="loadingRelationEvent"></form-loader>
                  <ng-scrollbar
                    [track]="'all'"
                    [ngStyle]="{
                      height: loadingRelationEvent ? '0px' : '400px'
                    }">
                    <ng2-smart-table
                      id="eventTable"
                      [settings]="eventSettings"
                      [source]="dataTableRelationEvent"
                      (userRowSelect)="selectRelatedEvent($event.selected)">
                    </ng2-smart-table>
                  </ng-scrollbar>
                  <app-pagination
                    [params]="dataTableParamsRelationEvent"
                    [totalItems]="totalRelationEvent">
                  </app-pagination>
                </div>
                <div class="col-md-12">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                      <strong>DESCRIPCIÓN</strong>
                      <div
                        class="badge badge-pill bg-light text-wrap ml-2 mr-2">
                        TOTALES
                      </div>
                    </li>
                    <li class="list-group-item">
                      <strong>Total de Pagos:</strong>
                      <div class="badge badge-pill bg-info text-wrap ml-2 mr-2">
                        {{ eventsTotalQuantity | number }}
                      </div>
                    </li>
                    <li class="list-group-item">
                      <strong>Monto Total:</strong>
                      <div class="badge badge-pill bg-info text-wrap ml-2 mr-2">
                        ${{ formatTotalAmount(eventsTotalAmount) }}
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </tab>
            <tab heading="Cuentas de Banco Relacionadas" id="accountsTab">
              <div class="row mt-3">
                <div class="col-sm-12 col-md-6">
                  <h5 class="title">Cuentas de Bancos Relacionadas</h5>
                </div>
                <div class="col-sm-12 col-md-6 text-end">
                  <div class="d-flex flex-row-reverse">
                    <div class="">
                      <app-columns-select
                        [(settings)]="accountSettings"></app-columns-select>
                    </div>
                  </div>
                </div>
                <div class="col-12" name="COMER_CTLDEVPAG_B">
                  <form-loader *ngIf="loadingBank"></form-loader>
                  <ng-scrollbar
                    [track]="'all'"
                    [ngStyle]="{ height: loadingBank ? '0px' : '400px' }">
                    <ng2-smart-table
                      id="accountTable"
                      [settings]="accountSettings"
                      [source]="dataTableBank"
                      (userRowSelect)="selectAccounts($event.data)">
                    </ng2-smart-table>
                  </ng-scrollbar>
                  <app-pagination
                    [params]="dataTableParamsBank"
                    [totalItems]="accountTotalItems">
                  </app-pagination>
                </div>
                <div class="col-md-12">
                  <div class="row mt-2">
                    <form class="form-material" [formGroup]="controlForm2">
                      <div class="col-sm-9">
                        <form-field [control]="controlForm2.get('txtMsg')">
                          <input
                            readonly
                            type="text"
                            maxlenght="100"
                            class="form-control"
                            formControlName="txtMsg" />
                        </form-field>
                      </div>
                    </form>
                  </div>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                      <strong>DESCRIPCIÓN</strong>
                      <div
                        class="badge badge-pill bg-light text-wrap ml-2 mr-2">
                        TOTALES
                      </div>
                    </li>
                    <li class="list-group-item">
                      <strong>Total de Pagos:</strong>
                      <div class="badge badge-pill bg-info text-wrap ml-2 mr-2">
                        {{ accountsTotalQuantity | number }}
                      </div>
                    </li>
                    <li class="list-group-item">
                      <strong>Monto Total:</strong>
                      <div class="badge badge-pill bg-info text-wrap ml-2 mr-2">
                        ${{ formatTotalAmount(accountsTotalAmount) }}
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </tab>
            <tab heading="Pagos en Cuentas Bancarias" id="paymentsTab">
              <div class="row mt-3">
                <div class="col-sm-12 col-md-6">
                  <h5 class="title">Pagos en Cuentas Bancarias</h5>
                </div>
                <div class="col-sm-12 col-md-6 text-end">
                  <div class="d-flex flex-row-reverse">
                    <div>
                      <app-columns-select
                        [(settings)]="paymentSettings"></app-columns-select>
                    </div>
                    <div>
                      <button
                        class="btn btn-sm btn-primary active me-2 font-size-13"
                        (click)="openTransferDateModal()">
                        Fecha de Transferencia
                        <i class="fa fa-calendar" aria-hidden="true"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-12" name="COMER_CTLDEVPAG_P">
                  <form-loader *ngIf="loadingBankAccount"></form-loader>
                  <ng-scrollbar
                    [track]="'all'"
                    [ngStyle]="{
                      height: loadingBankAccount ? '0px' : '400px'
                    }">
                    <ng2-smart-table
                      id="paymentTable"
                      [settings]="paymentSettings"
                      [source]="dataTableBankAccount"
                      (userRowSelect)="selectPayment($event.data)">
                    </ng2-smart-table>
                  </ng-scrollbar>
                  <app-pagination
                    [params]="dataTableParamsBankAccount"
                    [totalItems]="accountTotalItemsP">
                  </app-pagination>
                </div>
                <div class="col-md-12">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                      <strong>DESCRIPCIÓN</strong>
                      <div
                        class="badge badge-pill bg-light text-wrap ml-2 mr-2">
                        TOTALES
                      </div>
                    </li>
                    <li class="list-group-item">
                      <strong>Monto Total:</strong>
                      <div class="badge badge-pill bg-info text-wrap ml-2 mr-2">
                        ${{ formatTotalAmount(totalAmountAccount) }}
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </tab>
          </tabset>
        </div>
        <div class="row mt-4">
          <div class="col-sm-12 col-md-12">
            <div
              class="row row-cols-sm-1 row row-cols-1 row-cols-md-2 row row-cols-lg-3 row-cols-xl-4 g-3">
              <div class="col">
                <button
                  [ngClass]="{ loading: btnLoading }"
                  [disabled]="btnLoading"
                  class="btn btn-sm btn-info btn-block active me-2 font-size-13"
                  (click)="getComerCreationData()">
                  Crear Control
                  <i
                    *ngIf="!btnLoading"
                    class="bx bx-plus bx-sm float-icon"></i>
                </button>
              </div>
              <div class="col">
                <button
                  [ngClass]="{ loading: btnLoading2 }"
                  [disabled]="btnLoading2"
                  class="btn btn-sm btn-primary btn-block active me-2 font-size-13"
                  (click)="requestSpentGenerator()"
                  [disabled]="!disabledBtn">
                  Generar Solicitudes Gastos
                  <i *ngIf="!btnLoading2" class="bi bi-cash"></i>
                </button>
                <!-- (click)="changeLayout('EXPENSE REQUEST')" -->
              </div>
              <div class="col">
                <button
                  [ngClass]="{ loading: btnLoading3 }"
                  [disabled]="btnLoading3"
                  class="btn btn-sm btn-primary btn-block active me-2 font-size-13"
                  (click)="sendRequests()"
                  [disabled]="!disabledBtn">
                  Enviar Solicitudes a SIRSAE
                  <i *ngIf="!btnLoading3" class="bx bx-send"></i>
                </button>
              </div>
              <div class="col">
                <button
                  [ngClass]="{ loading: btnLoading4 }"
                  [disabled]="btnLoading4"
                  class="btn btn-sm btn-primary btn-block active me-2 font-size-13"
                  (click)="verifyPaysSirsae()"
                  [disabled]="!disabledBtn">
                  Verificar pagos SIRSAE
                </button>
              </div>
              <div class="col">
                <button
                  [disabled]="!valBtns"
                  class="btn btn-sm btn-danger btn-block active me-2 font-size-13"
                  (click)="changeLayout()">
                  Mantenimiento de Layouts
                  <i class="fas fa-wrench"></i>
                </button>
              </div>
              <div class="col">
                <button
                  [disabled]="!valBtns"
                  class="btn btn-sm btn-danger btn-block active me-2 font-size-13"
                  (click)="openCreationModal()">
                  Permisos de Creaci&oacute;n
                  <i class="bx bxs-file"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="layout == 'EXPENSE REQUEST'" @OnInOut>
      <app-expenses-request (onReturn)="refresh()"></app-expenses-request>
    </div>
    <div *ngIf="layout == 'MAINTENANCE'" @OnInOut>
      <app-layout-maintenance (onReturn)="refresh()"></app-layout-maintenance>
    </div>
  </div>
</app-card>
