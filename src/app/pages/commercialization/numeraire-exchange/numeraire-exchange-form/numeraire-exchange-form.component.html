<app-card [header]="true">
  <div class="ch-content" header>
    <h5 class="title">conversión a numerario</h5>
  </div>
  <div body>
    <div class="md-tabs mt-n3">
      <tabset>
        <tab heading="Conversión Individual" id="tabIndividualConversion">
          <form class="form-material mb-0" [formGroup]="numeraireExchangeForm">
            <div class="row mb-0 d-block">
              <div
                class="row d-flex justify-content-center align-content-center">
                <div class="col-sm-12 col-md-4 mh-80">
                  <i
                    class="bx bx-list-ul text-success me-2 d-inline float-icon"></i>
                  <h5 class="font-size-14 mb-2 d-inline">N° Bien</h5>
                  <ngx-select
                    [form]="numeraireExchangeForm"
                    [data]="goodItems"
                    value="id"
                    bindLabel="id"
                    (fetchItems)="getGoods($event)"
                    (change)="selectGood($event)"
                    control="id">
                  </ngx-select>
                </div>
                <div
                  class="col-sm-12 col-md-8"
                  *ngIf="selectedGood != null"
                  @OnGoodSelected>
                  <div class="row">
                    <div class="col-4 d-flex justify-content-center">
                      <div>
                        <i
                          class="bx bx-font-family text-success me-2 d-inline float-icon"></i>
                        <h5 class="font-size-14 mb-2 d-inline">Siglas</h5>
                        <p class="text-muted">{{ selectedGood.code }}</p>
                      </div>
                    </div>
                    <div class="col-8">
                      <i
                        class="bx bx-detail text-success me-2 d-inline float-icon"></i>
                      <h5 class="font-size-14 mb-2 d-inline">Descripción</h5>
                      <p class="text-muted">
                        {{ selectedGood.description }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mt-3" *ngIf="selectedGood != null" @OnGoodSelected>
              <div class="col-sm-12 col-md-3">
                <i
                  class="bx bx-dollar text-success me-2 d-inline float-icon"></i>
                <h5 class="font-size-14 mb-2 d-inline">Importe Avalúo</h5>
                <p class="text-muted">
                  {{ selectedGood.appraisal }}
                </p>
              </div>
              <div class="col-sm-12 col-md-5">
                <i
                  class="bx bx-check-circle text-success me-2 d-inline float-icon"></i>
                <h5 class="font-size-14 mb-2 d-inline">Estatus</h5>
                <p class="text-muted">
                  {{ selectedGood.status }}
                </p>
              </div>
              <div class="col-sm-12 col-md-4">
                <i
                  class="bx bx-table text-success me-2 d-inline float-icon"></i>
                <h5 class="font-size-14 mb-2 d-inline">Ext. Dominio</h5>
                <p class="text-muted">
                  {{ selectedGood.domain }}
                </p>
              </div>
            </div>
            <div class="row mt-3" *ngIf="selectedGood != null" @OnGoodSelected>
              <div class="ms-n2 mb-2">
                <i class="bx bx-radio-circle bx-sm float-icon mx-1"></i>
                <h6 class="d-inline">Datos de venta</h6>
              </div>
              <hr class="mw-98" />
              <div class="row mt-2">
                <div class="col-sm-12 col-md-4">
                  <form-field
                    [control]="numeraireExchangeForm.get('salePrice')"
                    label="Precio de Venta">
                    <input
                      type="text"
                      class="form-control"
                      formControlName="salePrice"
                      (blur)="formatCurrency($event)"
                      (keypress)="validateCurrency($event)"
                      (input)="calculateSaleTax()" />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-4">
                  <form-field
                    [control]="numeraireExchangeForm.get('saleTaxPercent')"
                    label="% IVA">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="saleTaxPercent"
                      max="100"
                      (blur)="formatDecimals($event)"
                      (input)="calculateSaleTax()" />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-4">
                  <form-field
                    [control]="numeraireExchangeForm.get('saleTax')"
                    label="Iva Venta">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="saleTax"
                      readonly />
                  </form-field>
                </div>
              </div>
              <div class="row mt-5">
                <div class="col-sm-6 col-md-3">
                  <form-field
                    [control]="numeraireExchangeForm.get('commissionPercent')"
                    label="% Comisión">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="commissionPercent"
                      max="100"
                      (blur)="formatDecimals($event)"
                      (input)="calculateCommission()" />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-3">
                  <form-field
                    [control]="numeraireExchangeForm.get('commission')"
                    label="Comisión">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="commission"
                      readonly />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-3">
                  <form-field
                    [control]="
                      numeraireExchangeForm.get('commissionTaxPercent')
                    "
                    label="% IVA Comisión">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="commissionTaxPercent"
                      max="100"
                      (blur)="formatDecimals($event)"
                      (input)="calculateCommissionTax()" />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-3">
                  <form-field
                    [control]="numeraireExchangeForm.get('commissionTax')"
                    label="IVA Comisión">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="commissionTax"
                      readonly />
                  </form-field>
                </div>
              </div>
            </div>
            <div class="row" *ngIf="selectedGood != null" @OnGoodSelected>
              <div
                class="ms-n2 mb-2 pointer"
                (click)="toggleExpenses = !toggleExpenses"
                [attr.aria-expanded]="!toggleExpenses"
                aria-controls="collapseExpenses">
                <i
                  class="bx bx-chevron-down bx-md float-icon-md"
                  [ngClass]="{
                    'rotate-down': toggleExpenses,
                    'rotate-up': !toggleExpenses
                  }"></i>
                <h6 class="d-inline">Gastos</h6>
              </div>
              <hr class="mw-98" />
              <div
                class="row mb-5"
                id="collapseExpenses"
                [isAnimated]="true"
                [collapse]="!toggleExpenses">
                <div class="d-flex flex-row-reverse mb-4 mt-0">
                  <div class="">
                    <button
                      class="btn btn-sm btn-success active font-size-14"
                      (click)="addRow()"
                      [disabled]="adding">
                      Agregar Registro
                    </button>
                  </div>
                </div>
                <div class="table-container">
                  <div [class]="loading ? 'table-loading' : ''">
                    <ng2-smart-table
                      id="expenses-table"
                      [attr.class]="'table-bordered'"
                      [settings]="expenseSettings"
                      [source]="expenseColumns"
                      (createConfirm)="addEntry($event)"
                      (editConfirm)="editEntry($event)">
                    </ng2-smart-table>
                  </div>
                </div>
              </div>
            </div>
            <div class="row" *ngIf="selectedGood != null" @OnGoodSelected>
              <div class="ms-n2 mb-2">
                <i class="bx bx-radio-circle bx-sm float-icon mx-1"></i>
                <h6 class="d-inline">Datos de cuenta</h6>
              </div>
              <hr class="mw-98" />
              <div class="row mb-0 d-block">
                <div
                  class="row d-flex justify-content-center align-content-center">
                  <div class="col-sm-12 col-md-6 mh-80">
                    <i
                      class="bx bx-list-ul text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Banco</h5>
                    <ngx-select
                      [form]="numeraireExchangeForm"
                      [data]="accountItems"
                      value="id"
                      bindLabel="id"
                      (fetchItems)="getAccounts($event)"
                      (change)="selectAccount($event)"
                      control="account">
                    </ngx-select>
                  </div>
                  <div
                    class="col-sm-12 col-md-6"
                    *ngIf="selectedAccount != null">
                    <i
                      class="bx bx-detail text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Descripción</h5>
                    <p class="text-muted">
                      {{ selectedAccount.description }}
                    </p>
                  </div>
                  <div
                    class="col-sm-6 col-md-6"
                    *ngIf="selectedAccount != null">
                    <i
                      class="bx bx-detail text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Cuenta</h5>
                    <p class="text-muted">
                      {{ selectedAccount.number }}
                    </p>
                  </div>
                  <div
                    class="col-sm-6 col-md-6"
                    *ngIf="selectedAccount != null">
                    <i
                      class="bx bx-detail text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Moneda</h5>
                    <p class="text-muted">
                      {{ selectedAccount.currency }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="row" *ngIf="selectedGood != null" @OnGoodSelected>
              <div class="ms-n2 mb-2">
                <i class="bx bx-radio-circle bx-sm float-icon mx-1"></i>
                <h6 class="d-inline">Datos de depósito</h6>
              </div>
              <hr class="mw-98" />
              <div class="row">
                <div class="col-sm-6 col-md-4">
                  <form-field
                    [control]="numeraireExchangeForm.get('depositDate')"
                    label="Fecha">
                    <input
                      type="text"
                      formControlName="depositDate"
                      class="form-control"
                      bsDatepicker />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-4">
                  <form-field
                    [control]="numeraireExchangeForm.get('depositReferece')"
                    label="Referencia">
                    <input
                      type="text"
                      class="form-control"
                      formControlName="depositReferece" />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-4">
                  <form-field
                    [control]="numeraireExchangeForm.get('depositAmount')"
                    label="Importe">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="depositAmount"
                      readonly />
                  </form-field>
                </div>
              </div>
            </div>
            <div class="row" *ngIf="selectedGood != null" @OnGoodSelected>
              <div class="ms-n2 mb-2">
                <i class="bx bx-radio-circle bx-sm float-icon mx-1"></i>
                <h6 class="d-inline">Conversión</h6>
              </div>
              <hr class="mw-98" />
              <div class="row">
                <div class="col-sm-12 col-md-8 pt-sm-5 pt-md-2">
                  <form-field
                    [control]="numeraireExchangeForm.get('exchangeType')"
                    label="Tipo de conversión">
                    <ng-select
                      formControlName="exchangeType"
                      [searchable]="false"
                      class="form-control"
                      [clearable]="false">
                      <ng-option value="CBD"
                        >Bien decomisado cambiado a numerario por
                        enajenación</ng-option
                      >
                      <ng-option value="CDS"
                        >Bien decomisado cambiado a numerario por
                        siniestro</ng-option
                      >
                      <ng-option value="CNE1"
                        >Bien asegurado cambiado a numerario por
                        enajenación</ng-option
                      >
                      <ng-option value="CNS"
                        >Bien asegurado cambiado a numerario por
                        siniestro</ng-option
                      >
                      <ng-option value="BBB"
                        >Bien generado por pago parcial por siniestro</ng-option
                      >
                      <ng-option value="CNR"
                        >Bien cambiado a numerario por
                        responsabilidad</ng-option
                      >
                      <ng-option value="CNE"
                        >Bien cambiado a numerario por enajenación de valores y
                        divisas</ng-option
                      >
                      <ng-option value="1">Activo</ng-option>
                    </ng-select>
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-4 d-flex justify-content-center">
                  <div>
                    <button class="btn btn-primary active" (click)="exchange()">
                      Cambiar a numerario
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </tab>
        <tab heading="Conversión Masiva" id="tabMassiveConversion">
          <div class="row d-flex justify-content-center">
            <div class="col-sm-6 col-md-6 col-xl-4">
              <button
                class="btn btn-sm btn-block btn-primary active font-size-16"
                (click)="file.click()">
                Seleccionar
              </button>
              <input
                #file
                hidden
                type="file"
                class="custom-file-input"
                id="csvFile"
                accept=".csv"
                (change)="getFile($event)" />
            </div>
          </div>
          <div class="mt-3">
            <div class="d-flex justify-content-between">
              <div class="form-material col-md-5">
                <search-bar [params]="params"></search-bar>
              </div>
              <div>
                <app-columns-select
                  [(settings)]="numeraireSettings"></app-columns-select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="table-responsive">
              <div [class]="loading ? 'table-loading' : ''">
                <ng2-smart-table
                  id="massive-table"
                  [attr.class]="'table-bordered'"
                  [settings]="numeraireSettings"
                  [source]="numeraireColumns">
                </ng2-smart-table>
              </div>
            </div>
          </div>
          <app-pagination [params]="params" [totalItems]="totalItems">
          </app-pagination>
        </tab>
      </tabset>
    </div>
  </div>
</app-card>
