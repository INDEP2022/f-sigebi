<app-card [header]="true">
  <div class="ch-content" header>
    <h5 class="title">conversi&oacute;n a numerario</h5>
  </div>
  <div body>
    <div class="md-tabs mt-n3">
      <tabset>
        <tab heading="Conversión Individual" id="tabIndividualConversion">
          <form class="form-material mb-0" [formGroup]="form">
            <div class="row py-5 rounded-4 shadow">
              <div
                [ngClass]="selectedGood ? 'col-md-4' : 'col-md-12'"
                class="col-sm-12">
                <i
                  class="bx bx-list-ul text-success me-2 d-inline float-icon"></i>
                <h5 class="font-size-14 mb-2 d-inline">N° Bien</h5>
                <app-goods-shared (good)="selectGood($event)" [form]="form">
                </app-goods-shared>
              </div>
              <ng-container *ngIf="selectedGood">
                <div class="col-sm-12 col-md-4">
                  <div>
                    <i
                      class="bx bx-font-family text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Siglas</h5>
                    <p class="text-muted">
                      {{ selectedGood?.originSignals }}
                    </p>
                  </div>
                </div>
                <div class="col-sm-12 col-md-4">
                  <div>
                    <i
                      class="bx bx-detail text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Descripción</h5>
                    <p class="text-muted">
                      {{ selectedGood?.description }}
                    </p>
                  </div>
                </div>
                <div class="col-sm-12 col-md-4">
                  <div>
                    <i
                      class="bx bx-dollar text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Importe Avalúo</h5>
                    <p class="text-muted">
                      {{ selectedGood?.appraisedValue }}
                    </p>
                  </div>
                </div>
                <div class="col-sm-12 col-md-4">
                  <div>
                    <i
                      class="bx bx-check-circle text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Estatus</h5>
                    <p class="text-muted">
                      {{ selectedGood?.status }}
                    </p>
                  </div>
                </div>
                <div class="col-sm-12 col-md-4">
                  <div>
                    <i
                      class="bx bx-table text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Ext. Dominio</h5>
                    <p class="text-muted">
                      {{ selectedGood?.extDomProcess }}
                    </p>
                  </div>
                </div>
              </ng-container>
            </div>

            <div class="row mt-3 py-5 px-3 rounded-4 shadow" @OnGoodSelected>
              <div class="ms-n2 mb-2">
                <i class="bx bx-radio-circle bx-sm float-icon mx-1"></i>
                <h6 class="d-inline">Datos de venta</h6>
              </div>
              <hr class="mw-98" />
              <div class="row mt-2">
                <div class="col-sm-12 col-md-4">
                  <form-field
                    [control]="form.get('salePrice')"
                    label="Precio de Venta">
                    <input
                      class="form-control px-3"
                      formControlName="salePrice"
                      (blur)="formatCurrency2($event, true)"
                      (keyup)="multiCalculate($event)" />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-4">
                  <form-field
                    [control]="form.get('saleTaxPercent')"
                    label="% IVA">
                    <input
                      type="number"
                      class="form-control px-3"
                      formControlName="saleTaxPercent"
                      max="100"
                      (keyup)="calculateSaleTax($event)" />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-4">
                  <form-field [control]="form.get('saleTax')" label="Iva Venta">
                    <input
                      type="text"
                      class="form-control px-3"
                      formControlName="saleTax"
                      readonly />
                  </form-field>
                </div>
              </div>
              <div class="row mt-5">
                <div class="col-sm-6 col-md-3">
                  <form-field
                    [control]="form.get('commissionPercent')"
                    label="% Comisión">
                    <input
                      type="number"
                      class="form-control px-3"
                      formControlName="commissionPercent"
                      max="100"
                      (input)="calculateCommission()" />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-3">
                  <form-field
                    [control]="form.get('commission')"
                    label="Comisión">
                    <input
                      type="text"
                      class="form-control px-3"
                      formControlName="commission"
                      readonly />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-3">
                  <form-field
                    [control]="form.get('commissionTaxPercent')"
                    label="% IVA Comisión">
                    <input
                      type="number"
                      class="form-control px-3"
                      formControlName="commissionTaxPercent"
                      max="100"
                      (input)="calculateCommissionTax()" />
                  </form-field>
                </div>
                <div class="col-sm-6 col-md-3">
                  <form-field
                    [control]="form.get('commissionTax')"
                    label="IVA Comisión">
                    <input
                      type="text"
                      class="form-control px-3"
                      formControlName="commissionTax"
                      readonly />
                  </form-field>
                </div>
              </div>
            </div>

            <div
              class="row mt-3 py-5 px-3 rounded-4 shadow"
              *ngIf="selectedGood != null"
              @OnGoodSelected>
              <div
                class="ms-n2 mb-2 pointer"
                (click)="toggleExpenses = !toggleExpenses"
                [attr.aria-expanded]="!toggleExpenses"
                aria-controls="collapseExpenses">
                <i
                  class="bx bx-chevron-down bx-md float-icon-md"
                  [ngClass]="{
                    'rotate-down': toggleExpenses,
                    'rotate-up': !toggleExpenses
                  }"></i>
                <h6 class="d-inline">Gastos</h6>
              </div>
              <hr class="mw-98" />
              <div
                class="row mb-5"
                id="collapseExpenses"
                [isAnimated]="true"
                [collapse]="!toggleExpenses">
                <div class="table-container">
                  <div [class]="loading ? 'table-loading' : ''">
                    <app-table-expenses></app-table-expenses>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="row mt-3 py-5 px-3 rounded-4 shadow"
              *ngIf="selectedGood != null"
              @OnGoodSelected>
              <div class="ms-n2 mb-2">
                <i class="bx bx-radio-circle bx-sm float-icon mx-1"></i>
                <h6 class="d-inline">Datos de cuenta</h6>
              </div>
              <hr class="mw-98" />
              <div class="row mb-0 d-block">
                <div
                  class="row d-flex justify-content-center align-content-center">
                  <div class="col-sm-12 col-md-6 mh-80">
                    <i
                      class="bx bx-list-ul text-success me-2 d-inline float-icon"></i>
                    <h5 class="font-size-14 mb-2 d-inline">Banco</h5>
                    <div class="form-group">
                      <ng-custom-select
                        placeholder="Buscador de bancos"
                        class="form-control"
                        paramSearch="filter.cveBank"
                        prefixSearch="$ilike"
                        [moreParams]="{
                          'filter.accountType': '$eq:CONCENTRADORA'
                        }"
                        value="accountNumber"
                        formControlName="bank"
                        path="accountmvmnt/api/v1/bank-account"
                        (valueChange)="selectAccount($event)">
                        <ng-template let-item> {{ item.cveBank }} </ng-template>
                      </ng-custom-select>
                    </div>
                  </div>
                  <ng-container *ngIf="selectedBank">
                    <div class="col-sm-12 col-md-6">
                      <i
                        class="bx bx-detail text-success me-2 d-inline float-icon"></i>
                      <h5 class="font-size-14 mb-2 d-inline">
                        Descripci&oacute;n
                      </h5>
                      <p class="text-muted">
                        {{ selectedBank?.square }}
                      </p>
                    </div>
                    <div class="col-sm-6 col-md-6">
                      <i
                        class="bx bx-detail text-success me-2 d-inline float-icon"></i>
                      <h5 class="font-size-14 mb-2 d-inline">Cuenta</h5>
                      <p class="text-muted">
                        {{ selectedBank.cveAccount }}
                      </p>
                    </div>
                    <div class="col-sm-6 col-md-6">
                      <i
                        class="bx bx-detail text-success me-2 d-inline float-icon"></i>
                      <h5 class="font-size-14 mb-2 d-inline">Moneda</h5>
                      <p class="text-muted">
                        {{ selectedBank.cveCurrency }}
                      </p>
                    </div>
                  </ng-container>
                </div>
              </div>
            </div>
            <div
              class="row mt-3 py-5 px-3 rounded-4 shadow"
              *ngIf="selectedGood != null"
              @OnGoodSelected>
              <div class="ms-n2 mb-2">
                <i class="bx bx-radio-circle bx-sm float-icon mx-1"></i>
                <h6 class="d-inline">Datos de dep&oacute;sito</h6>
              </div>
              <hr class="mw-98" />
              <div class="row">
                <div class="col-sm-12 col-md-3">
                  <form-field [control]="form.get('depositDate')" label="Fecha">
                    <input
                      type="text"
                      formControlName="depositDate"
                      class="form-control"
                      bsDatepicker />
                  </form-field>
                </div>
                <div class="col-md-4">
                  <form-field
                    class="form-group"
                    [control]="form.get('depositReference')"
                    label="Referencia">
                    <ng-custom-select
                      class="form-control"
                      path="/accountmvmnt/api/v1/account-movements"
                      formControlName="depositReference">
                      <ng-template let-item> {{ item.cveBank }} </ng-template>
                    </ng-custom-select>
                  </form-field>
                </div>
                <div class="col-md-3">
                  <form-field
                    [control]="form.get('depositAmount')"
                    label="Importe">
                    <input
                      type="number"
                      class="form-control"
                      formControlName="depositAmount"
                      readonly />
                  </form-field>
                </div>
              </div>
            </div>
            <div
              class="row mt-3 py-5 px-3 rounded-4 shadow"
              *ngIf="selectedGood != null"
              @OnGoodSelected>
              <div class="ms-n2 mb-2">
                <i class="bx bx-radio-circle bx-sm float-icon mx-1"></i>
                <h6 class="d-inline">Conversi&oacute;n</h6>
              </div>
              <hr class="mw-98" />
              <div class="row">
                <div class="col-sm-12 col-md-8 pt-sm-5 pt-md-2">
                  <div class="form-group">
                    <form-field
                      class="form-group"
                      label="Tipo de conversión"
                      [control]="form.get('conversionType')">
                      <select
                        class="form-control"
                        formControlName="conversionType">
                        <option
                          [value]="type.value"
                          *ngFor="let type of conversionTypes">
                          {{ type.text }}
                        </option>
                      </select>
                    </form-field>
                  </div>
                </div>
                <div class="col-sm-6 col-md-4 d-flex justify-content-center">
                  <div>
                    <div class="col-12">
                      <input formControlName="" type="checkbox" />
                      Genera Mov. Bancarios
                    </div>
                    <div class="col-12">
                      <button
                        class="btn btn-primary active"
                        (click)="saveInServer()">
                        Cambiar a numerario
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </tab>
        <tab heading="Conversión Masiva" id="tabMassiveConversion">
          <div class="row d-flex justify-content-center">
            <div class="col-sm-6 col-md-6 col-xl-4">
              <button
                class="btn btn-sm btn-block btn-primary active font-size-16"
                (click)="file.click()">
                Seleccionar
              </button>
              <input
                #file
                hidden
                type="file"
                class="custom-file-input"
                id="csvFile"
                accept=".csv"
                (change)="getFile($event)" />
            </div>
          </div>
          <div class="mt-3">
            <div class="d-flex justify-content-between">
              <div class="form-material col-md-5">
                <search-bar [params]="params"></search-bar>
              </div>
              <div>
                <app-columns-select
                  [(settings)]="numeraireSettings"></app-columns-select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="table-responsive">
              <div [class]="loading ? 'table-loading' : ''">
                <ng2-smart-table
                  id="massive-table"
                  [attr.class]="'table-bordered'"
                  [settings]="numeraireSettings"
                  [source]="numeraireColumns">
                </ng2-smart-table>
              </div>
            </div>
          </div>
          <app-pagination [params]="params" [totalItems]="totalItems">
          </app-pagination>
        </tab>
      </tabset>
    </div>
  </div>
</app-card>
