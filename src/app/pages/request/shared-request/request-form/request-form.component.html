<app-card [header]="true">
  <div class="ch-content" header>
    <div class="d-flex">
      <div class="mr-auto p-2">
        <div *ngIf="op == 1; else optionTitle">
          <h5 class="modal-title">
            {{ edit ? 'ACTUALIZAR' : 'NUEVA' }} SOLICITUD
          </h5>
        </div>
        <ng-template #optionTitle>
          <h5 class="modal-title">Documentaci&oacute;n Complementaria</h5>
        </ng-template>
      </div>

      <div class="p-2">
        <button
          [disabled]="requestForm.invalid"
          (click)="save()"
          type="button"
          class="btn btn-primary btn-sm active">
          Guardar
          <i aria-hidden="true" class="fa fa-save"></i>
        </button>
        <!-- <confirm-button
          [btnSmall]="true"
          [disabled]="requestForm.invalid"
          (confirm)="save()">
        </confirm-button> -->
      </div>
      <div class="p-2">
        <button
          [disabled]="requestForm.invalid || !requestId || !isUserNameValid"
          type="button"
          class="btn btn-primary btn-sm active"
          (click)="turnRequest()">
          Turnar
          <i aria-hidden="true" class="fa fa-share-square"></i>
        </button>
      </div>
    </div>
  </div>
  <div body class="body">
    <form [formGroup]="requestForm" class="form-material">
      <app-card [header]="false">
        <div body>
          <div
            class="ms-n2 mb-2 pointer"
            (click)="showSearchForm = !showSearchForm"
            [attr.aria-expanded]="!showSearchForm"
            aria-controls="collapseInfo">
            <i
              class="bx bx-chevron-down bx-md float-icon-md"
              [ngClass]="{
                'rotate-down': showSearchForm,
                'rotate-up': !showSearchForm
              }"></i>
            <h6 class="d-inline">Informaci&oacute;n de la Solicitud</h6>
          </div>

          <div
            id="collapseInfo"
            [isAnimated]="true"
            [collapse]="!showSearchForm">
            <div class="row pt-5">
              <div class="col-md-2">
                <form-field
                  [control]="requestForm.get('applicationDate')"
                  label="Fecha de Solicitud">
                  <input
                    class="form-control"
                    #dp="bsDatepicker"
                    formControlName="applicationDate"
                    bsDatepicker
                    [bsValue]="bsValue" />
                </form-field>
              </div>

              <div class="col-md-3">
                <ngx-select
                  [form]="requestForm"
                  control="regionalDelegationId"
                  (fetchItems)="getRegionalDeleg($event)"
                  [data]="selectRegionalDeleg"
                  bindLabel="description"
                  label="Delegaci&oacute;n Regional"
                  value="id"
                  (change)="regDeleChange($event)"></ngx-select>
              </div>
              <div class="col-md-3">
                <form-field
                  [control]="requestForm.get('paperNumber')"
                  label="No&#46; Oficio">
                  <input
                    type="text"
                    class="form-control"
                    formControlName="paperNumber"
                    maxlength="50" />
                </form-field>
              </div>
              <div class="col-md-3">
                <ngx-select
                  [form]="requestForm"
                  control="keyStateOfRepublic"
                  (fetchItems)="getEntity($event)"
                  [data]="selectEntity"
                  bindLabel="descCondition"
                  [searchable]="false"
                  label="{{ keyStateName }}"
                  value="id"></ngx-select>
              </div>
            </div>
            <div class="row pt-5">
              <div class="col-md-4">
                <ngx-select
                  [form]="requestForm"
                  control="transferenceId"
                  (fetchItems)="getTransferent($event)"
                  [showTooltip]="true"
                  [data]="transferents$"
                  bindLabel="nameAndId"
                  label="Transferente"
                  value="id"
                  (change)="changeTransf($event)"></ngx-select>
              </div>
              <div class="col-md-4">
                <ngx-select
                  [form]="requestForm"
                  control="stationId"
                  (fetchItems)="getStation($event)"
                  [showTooltip]="true"
                  [data]="selectStation"
                  bindLabel="nameAndId"
                  label="Emisora"
                  value="id"></ngx-select>
              </div>
              <div class="col-md-4">
                <ngx-select
                  [form]="requestForm"
                  control="authorityId"
                  (fetchItems)="getAuthority($event)"
                  [showTooltip]="true"
                  [data]="selectAuthority"
                  bindLabel="nameAndId"
                  label="Autoridad"
                  value="idAuthority"></ngx-select>
              </div>
            </div>
          </div>
        </div>
      </app-card>
      <div>
        <img
          *ngIf="loadingTurn"
          src="assets/images/loader-button.gif"
          alt="loading"
          id="loading" />
      </div>
      <div *ngIf="op == 2">
        <app-card [header]="true">
          <div class="ch-content" header>
            <h6 class="title">Seleccione el Asunto</h6>
          </div>
          <div body>
            <div class="row pt-5">
              <div class="col-md-6">
                <form-field [control]="requestForm.get('affair')">
                  <ngx-select
                    (fetchItems)="getIssue($event)"
                    [data]="issues"
                    [form]="requestForm"
                    value="id"
                    bindLabel="description"
                    label="Asunto"
                    [control]="'affair'"
                    (change)="affairChange($event)">
                  </ngx-select>
                </form-field>
              </div>
            </div>
          </div>
        </app-card>
      </div>

      <app-card [header]="true">
        <div class="ch-content" header>
          <h6 class="title">Seleccione Usuario a Turnar</h6>
        </div>
        <div body>
          <div class="row pt-5">
            <div class="col-md-3" style="line-height: 2.5">
              Tipo de Usuario&#58;
            </div>
            <div class="row ml-5">
              <div
                class="col-md-3 d-flex"
                *ngIf="!displayOfficeCenter && !displayOfficeCenterED">
                <div>
                  <form-radio label="T.E">
                    <input
                      type="radio"
                      formControlName="targetUserType"
                      value="TE"
                      id="te" />
                  </form-radio>
                </div>
                <div>
                  <form-radio label="INDEP">
                    <input
                      type="radio"
                      formControlName="targetUserType"
                      value="SAE"
                      id="sae"
                      [checked]="checked" />
                  </form-radio>
                </div>
              </div>
              <!-- se habilita las oficinas centrales -->
              <div
                class="col-md-3"
                *ngIf="displayOfficeCenter && !displayOfficeCenterED">
                <div class="col-sm-2">
                  <form-radio label="Ofinas Centrales">
                    <input
                      type="radio"
                      formControlName="targetUserType"
                      value="SAE"
                      id="sae"
                      [checked]="checked" />
                  </form-radio>
                </div>
              </div>
              <div class="col-md-3 d-flex" *ngIf="displayOfficeCenterED">
                <div>
                  <form-radio label="T.E">
                    <input
                      type="radio"
                      formControlName="targetUserType"
                      value="TE"
                      id="te" />
                  </form-radio>
                </div>
                <div>
                  <form-radio label="INDEP">
                    <input
                      type="radio"
                      formControlName="targetUserType"
                      value="SAE"
                      id="sae"
                      [checked]="checked" />
                  </form-radio>
                </div>
              </div>

              <div class="col-md-3">
                <button
                  type="button"
                  data-toggle="tooltip"
                  title="Agregar"
                  class="btn btn-info btn-sm active ml-2 mr-2"
                  (click)="openModalSelectUser()">
                  <i class="bx bx-plus bx-sm float-icon"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="row pt-5">
            <div class="col-md-3">Usuario Recepci&oacute;n&#58;</div>
            <div class="col-md-3">
              <input
                type="text"
                class="form-control"
                [ngModelOptions]="{ standalone: true }"
                [(ngModel)]="userName"
                [readOnly]="true"
                value="userName" />
            </div>
          </div>
        </div>
      </app-card>
    </form>
  </div>
</app-card>
