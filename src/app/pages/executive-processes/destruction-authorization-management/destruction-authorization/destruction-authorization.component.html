<app-card [header]="true">
  <div header>
    <div class="ch-content">
      <h5 class="title">
        GESTI&Oacute;N DE AUTORIZACI&Oacute;N DE DESTRUCCI&Oacute;N
      </h5>
    </div>
  </div>
  <div body>
    <form class="form-material" [formGroup]="proceedingForm">
      <div class="row">
        <form-field
          class="col-md-2"
          label="No. de Acta"
          [control]="proceedingForm.get('id')">
          <input
            type="text"
            class="form-control"
            formControlName="id"
            [readonly]="
              controls.statusProceedings.value == 'CERRADA' || newProceedingFlag
            " />
        </form-field>

        <form-field
          class="col-md-4"
          label="Oficio de Solicitud"
          [control]="proceedingForm.get('keysProceedings')">
          <input
            type="text"
            [readonly]="
              controls.statusProceedings.value == 'CERRADA' || searched
            "
            [max-length]="60"
            class="form-control"
            formControlName="keysProceedings" />
        </form-field>

        <form-field
          class="col-md-4"
          label="Oficio de Alcance"
          [control]="proceedingForm.get('affair')">
          <input
            type="text"
            [readonly]="
              controls.statusProceedings.value == 'CERRADA' || searched
            "
            [max-length]="70"
            class="form-control"
            formControlName="affair" />
        </form-field>

        <form-field
          class="col-md-2"
          label="Estatus"
          [control]="proceedingForm.get('statusProceedings')">
          <input
            type="text"
            [style.color]="
              controls.statusProceedings.value == 'CERRADA' ? 'red' : 'green'
            "
            class="form-control"
            formControlName="statusProceedings"
            readonly />
        </form-field>
      </div>
      <div class="row pt-4">
        <form-field
          class="col-md-4"
          label="Fecha de Recepción"
          [control]="proceedingForm.get('elaborationDate')">
          <input
            type="text"
            class="form-control"
            [readonly]="
              controls.statusProceedings.value == 'CERRADA' || searched
            "
            formControlName="elaborationDate"
            bsDatepicker
            [bsConfig]="{
              dateInputFormat: 'DD/MM/YYYY'
            }" />
        </form-field>
        <form-field
          class="col-md-4"
          label="Fecha de Alcance"
          [control]="proceedingForm.get('datePhysicalReception')">
          <input
            type="text"
            class="form-control"
            [readonly]="
              controls.statusProceedings.value == 'CERRADA' || searched
            "
            formControlName="datePhysicalReception"
            bsDatepicker
            [bsConfig]="{
              dateInputFormat: 'DD/MM/YYYY'
            }" />
        </form-field>
        <form-field
          class="col-md-4"
          label="Fecha de Intergracion"
          [control]="proceedingForm.get('closeDate')">
          <input
            type="text"
            #closeDate
            class="form-control"
            [readonly]="
              controls.statusProceedings.value == 'CERRADA' || searched
            "
            formControlName="closeDate"
            bsDatepicker
            [bsConfig]="{
              dateInputFormat: 'DD/MM/YYYY'
            }" />
        </form-field>
      </div>
    </form>
    <div class="row text-center mb-5">
      <div class="col-md-12">
        <div>
          <button
            class="btn btn-primary btn-sm active mr-3"
            (click)="keyProceedingchange()">
            Buscar
            <i class="bx bx-search-alt bx-sm float-icon"></i>
          </button>
          <button
            *ngIf="!newProceedingFlag"
            type="button"
            tooltip="Nueva acta"
            (click)="newProceedingFn()"
            containerClass="tooltip-style"
            class="btn btn-info btn-sm active mr-3">
            Nuevo <i class="bx bx-plus bx-sm float-icon"></i>
          </button>
          <confirm-button
            *ngIf="newProceedingFlag"
            [disabled]="controls.statusProceedings.value == 'CERRADA'"
            text="Guardar"
            loadingText="Guardando"
            [btnSmall]="true"
            class="mr-3"
            type="button"
            (confirm)="save()"></confirm-button>

          <!-- <button class="btn btn-primary btn-sm active mr-3" (click)="update()">
            Actualizar <i class="fas fa-sync-alt"> </i>
          </button> -->
          <button
            *ngIf="controls.statusProceedings.value != 'CERRADA'"
            (click)="closeProceeding()"
            class="btn btn-primary btn-sm active mr-3">
            {{
              controls.statusProceedings.value != 'CERRADA'
                ? 'Cerrar Acta'
                : 'Sacar bienes'
            }}
          </button>
          <button class="btn btn-danger btn-sm active" (click)="clearFn()">
            Limpiar <i class="fas fa-eraser"> </i>
          </button>
        </div>
      </div>
    </div>

    <div class="row pt-5">
      <div class="col-md-6">
        <div [class]="loadingActReception ? 'table-loading' : ''">
          <div class="table-responsive">
            <ng2-smart-table
              [settings]="settings4"
              [source]="actaList2"></ng2-smart-table>
          </div>
          <app-pagination
            [params]="params5"
            [totalItems]="totalItems5"></app-pagination>
        </div>
      </div>
      <div class="col-md-6">
        <div [class]="loadingDictation ? 'table-loading' : ''">
          <div class="table-responsive">
            <ng2-smart-table
              [settings]="settings5"
              [source]="dictaList2"></ng2-smart-table>
          </div>
          <app-pagination
            [params]="params6"
            [totalItems]="totalItems6"></app-pagination>
        </div>
      </div>
    </div>
    <form class="form-material" [formGroup]="proceedingForm">
      <div class="row">
        <div class="col-md-3">
          <form-field
            [control]="proceedingForm.get('universalFolio')"
            label="Folio de Escaneo">
            <input
              [disabled]="true"
              type="number"
              class="form-control"
              min="1"
              formControlName="universalFolio"
              maxlength="15" />
          </form-field>
        </div>
        <div class="col-md-3">
          <button
            type="button"
            data-toggle="tooltip"
            class="btn btn-secondary btn-sm active mr-3"
            (click)="scanRequest()"
            title="Generar Folio de Escaneo y Solicitud">
            <i class="bx bxs-file-find"></i>
          </button>
          <button
            type="button"
            data-toggle="tooltip"
            class="btn btn-secondary btn-sm active mr-3"
            (click)="scan()"
            title="Escanear">
            <i class="bx bxs-file"></i>
          </button>
          <button
            type="button"
            data-toggle="tooltip"
            class="btn btn-secondary btn-sm active mr-3"
            (click)="printReport()"
            title="Imprimir">
            <i class="bx bx-printer bx-sm float-icon"></i>
          </button>
        </div>
      </div>
      <div class="row pt-4">
        <form-field
          class="col-md-12"
          label="Observaciones"
          [control]="proceedingForm.get('observations')">
          <textarea
            rows="2"
            maxlength="1000"
            class="form-control"
            formControlName="observations"></textarea>
        </form-field>
      </div>
    </form>
    <div class="row text-center mb-4 mt-4">
      <div class="col">
        <button
          class="btn btn-primary btn-sm active"
          (click)="getGoodByStatusPDS()">
          Cargar bienes
        </button>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="row">
          <div [class]="loadingGoods ? 'table-loading' : ''">
            <ng2-smart-table
              [settings]="settings3"
              (userRowSelect)="selectGoodGeneral($event)"
              [source]="goodPDS1"></ng2-smart-table>
            <app-pagination
              [params]="params8"
              [totalItems]="totalItems3"></app-pagination>
          </div>
        </div>
      </div>
    </div>
    <div class="row text-center">
      <div class="col-md-2"></div>
      <div class="col-md-8">
        <p class="d-flex justify-content-center">
          <span class="text-success mr-5"
            ><i class="fa fa-square"></i> Disponibles</span
          >
          <span class="text-black"
            ><i class="fa fa-square"></i> No disponible</span
          >
        </p>
      </div>
      <div class="col-md-2"></div>
    </div>
    <div class="row pt-2 pb-4">
      <div class="col-md-12 d-flex justify-content-center">
        <div class="d-flex justify-content-center align-items-sm-center">
          <div class="col-md-3">
            <label for="">Agregar</label>
            <button
              tooltip="Agregar Bien"
              containerClass="tooltip-style"
              class="btn btn-secondary btn-sm active m-3 p-1 pointer"
              type="button"
              (click)="insertGood()">
              <!-- Mover uno -->
              <i class="bx bx-chevron-down bx-md"></i>
            </button>
          </div>
          <div class="col-md-3">
            <label for="">Eliminar</label>
            <button
              tooltip="Quitar Bien"
              containerClass="tooltip-style"
              class="btn btn-secondary btn-sm active m-3 p-1 pointer"
              type="button"
              (click)="deleteGood()">
              <!-- Quitar uno -->
              <i class="bx bx-chevron-up bx-md"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="row pt-5">
      <div class="col-md-12 table-responsive">
        <div class="row">
          <div [class]="loadingGoodsByP ? 'table-loading' : ''">
            <!-- <div class="table-responsive"> -->
            <ng2-smart-table
              [settings]="settings2"
              (userRowSelect)="selectGoodActa($event)"
              [source]="detailProceedingsList2"></ng2-smart-table>
            <app-pagination
              [params]="params7"
              [totalItems]="totalItems2"></app-pagination>
          </div>
        </div>

        <div class="row pt-5">
          <div class="d-flex justify-content-center">
            <div class="m-3">
              <input
                type="file"
                name="file"
                #file
                class="d-none"
                accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
                (change)="onFileChange($event)" />
              <button
                type="button"
                tooltip="Agregar"
                containerClass="tooltip-style"
                [disabled]="flatGoodFlag"
                class="btn btn-info btn-sm active ml-2 mr-2"
                (click)="file.click()">
                Insertar vía Archivo plano
                <i
                  *ngIf="!flatGoodFlag"
                  class="bi bi-file-earmark-excel-fill"></i>
                <i
                  *ngIf="flatGoodFlag"
                  class="spinner-border spinner-border-sm"></i>
              </button>
            </div>
            <div class="m-3">
              <button
                type="button"
                tooltip="Agregar"
                containerClass="tooltip-style"
                class="btn btn-info btn-sm active ml-2 mr-2"
                (click)="insertFromGoodsTracker()">
                Insertar vía rastreador
                <i class="bx bx-plus bx-sm float-icon"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</app-card>

<ng-template #modal>
  <app-modal>
    <div header>
      <h5 class="modal-title">Lista de bienes rechazados</h5>
    </div>
    <div body>
      <div class="row" style="margin-top: -50px !important">
        <div class="col-md-12">
          <ul>
            <li *ngFor="let good of refusedGoods">
              <p>Bien: {{ good }}</p>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div footer>
      <div class="d-flex justify-content-center">
        <div class="m-3">
          <!-- <button type="button" class="btn btn-primary active" (click)="hideObservations()">
                  Guardar
                </button> -->
        </div>
        <div class="m-3">
          <button
            type="button"
            class="btn btn-danger active btn-sm"
            (click)="hideRefusedGoods()">
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </app-modal>
</ng-template>
